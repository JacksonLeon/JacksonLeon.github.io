<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>人生苦短，我用Docker | GeekJoe</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">Posts</a></li>
      
      <li><a href="/note/">Notes</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">人生苦短，我用Docker</span></h1>

<h2 class="date">2019/10/10</h2>
</div>

<main>
<h1 id="人生苦短我用docker">人生苦短，我用Docker</h1>
<ol>
<li>使用服务器Docker服务搭建Deepo-jupyter深度学习框架</li>
</ol>
<h2 id="使用服务器docker服务搭建deepo-jupyter深度学习框架">使用服务器Docker服务搭建Deepo-jupyter深度学习框架</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># 需要保证服务器已经安装docker以及nvidia-docker</span>
<span style="color:#75715e"># 首先服务器拉取deepo镜像</span>
<span style="color:#75715e"># 注意换源，不然会非常慢的</span>
docker pull ufoym/deepo:all-py36-jupyter
<span style="color:#75715e"># 开启deepo</span>
<span style="color:#75715e"># -it 保持输入与交互</span>
<span style="color:#75715e"># -p 端口映射，服务器的7777映射到docker的8888</span>
<span style="color:#75715e"># -v 文件保存</span>
<span style="color:#75715e"># --name 设置容器名字</span>
nvidia-docker run -it -p 7777:8888 --ipc<span style="color:#f92672">=</span>host -v /home/username/Projects/:/Projects --name deepo-jupyter ufoym/deepo:all-py36-jupyter
<span style="color:#75715e"># 注意下次启动直接使用容器，不需要重新创建</span>
docker container start deepo-jupyter
docker container attach deepo-jupyter
<span style="color:#75715e"># 启动jupyter-notebook</span>
nohup jupyter notebook --no-browser --ip<span style="color:#f92672">=</span>0.0.0.0 --allow-root --NotebookApp.token<span style="color:#f92672">=</span> --notebook-dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/Projects&#39;</span>
<span style="color:#75715e"># 如果想在本地机器的浏览器中使用jupyter的话，ssh登录的时候需要指定端口映射</span>
<span style="color:#75715e"># 本地1234映射到host的127.0.0.1:7777</span>
ssh username@host-ip -L 1234:127.0.0.1:7777
#
<span style="color:#75715e"># 设置alias</span>
<span style="color:#75715e"># 本地</span>
alias ssh-jupyter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ssh -p 22 name@ip -L 1234:127.0.0.1:7777&#34;</span>
<span style="color:#75715e"># host</span>
alias deepo-jupyter-create<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;nvidia-docker run -it -p 7777:8888 --ipc=host -v /home/username/Jupyter/:/Jupyter --name deepo-jupyter ufoym/deepo:all-py36-jupyter&#39;</span>
alias deepo-jupyter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;docker container start deepo-jupyter &amp;&amp; docker container attach deepo-jupyter&#39;</span>
<span style="color:#75715e"># docker-jupyter</span>
vim /etc/bash.bashrc
alias deepo-jupyter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;nohup jupyter notebook --no-browser --ip=0.0.0.0 --allow-root --NotebookApp.token= --notebook-dir=&#34;/Projects&#34; &amp;&#39;</span>
source /etc/bash.bashrc
<span style="color:#75715e"># enjoy it!</span>
127.0.0.1:1234
</code></pre></div><h2 id="docker容器挂载主机目录后的权限问题">Docker容器挂载主机目录后的权限问题</h2>
<p>由于Docker使用root权限运行，挂载目录后，容器内创建文件后的权限就变成了root，主机就没有权限修改。而docker是通过用户的uid和gid来分辨用户和用户组，所以我们可以通过创建非root用户，并修改其uid和gid与主机用户保持一致，从而保证主机用户对挂载目录的权限。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">useradd user
usermod -u <span style="color:#ae81ff">1001</span> user
groupmod -g <span style="color:#ae81ff">1001</span> user
chown -R user.user files
</code></pre></div>
</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script async src="//yihui.name/js/center-img.js"></script>
  
  <hr/>
  © <a href="https://imlauzh.github.io">Joseph Lau</a> 2017 &ndash; 2019 | <a href="https://github.com/imlauzh">Github</a>
  
  </footer>
  </body>
</html>

