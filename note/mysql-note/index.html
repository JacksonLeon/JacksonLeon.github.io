<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MySQL Note | GeekJoe</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">Posts</a></li>
      
      <li><a href="/note/">Notes</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">MySQL Note</span></h1>

<h2 class="date">2018/12/07</h2>
</div>

<main>
<h2 id="description">Description</h2>
<blockquote>
<p>此文用来记录平时使用MySQL遇到的问题与心得.</p>
<p>本文长期更新.</p>
</blockquote>
<h2 id="mysql常用命令">MySQL常用命令</h2>
<ul>
<li>为用户修改密码</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SET</span> PASSWORD <span style="color:#66d9ef">FOR</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Username</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Host</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">PASSWORD</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">password</span><span style="color:#e6db74">&#39;</span>);
</code></pre></div><ul>
<li>创建用户</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> Username <span style="color:#66d9ef">IDENTIFIED</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">password</span><span style="color:#e6db74">&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span>, <span style="color:#66d9ef">INSERT</span>, <span style="color:#66d9ef">UPDATE</span>, <span style="color:#66d9ef">DELETE</span>, EXECUTE <span style="color:#66d9ef">ON</span> snatch.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Username</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%</span><span style="color:#e6db74">&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">password</span><span style="color:#e6db74">&#39;</span>;
<span style="color:#66d9ef">FLUSH</span> <span style="color:#66d9ef">PRIVILEGES</span>;
</code></pre></div><ul>
<li>删除用户</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">Delete</span> <span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">Where</span> <span style="color:#66d9ef">User</span><span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user-name</span><span style="color:#e6db74">&#39;</span> <span style="color:#66d9ef">and</span> Host<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">host</span><span style="color:#e6db74">&#39;</span>;
</code></pre></div><h2 id="mysql遇到的问题">MySQL遇到的问题</h2>
<h3 id="innodb引擎自增id中断问题">InnoDB引擎自增id中断问题</h3>
<blockquote>
<p>如果在插入的过程中出现了删除的操作,那么下一条数据的自增id将跳过这个id,从而出现自增id中断的问题.</p>
</blockquote>
<p>如何检查:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 如果两个数不一样,那么就说明中间出现了断层
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">FROM</span> table_name;
<span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">MAX</span>(id) <span style="color:#66d9ef">FROM</span> table_name;
<span style="color:#75715e"># 显示断层的id
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> id <span style="color:#66d9ef">FROM</span> 
(<span style="color:#66d9ef">SELECT</span> id <span style="color:#66d9ef">FROM</span> table_name <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> id <span style="color:#66d9ef">ASC</span>) t <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">FROM</span> table_name <span style="color:#66d9ef">WHERE</span> id<span style="color:#f92672">=</span>t.id<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</code></pre></div><p>解决办法</p>
<ul>
<li>不适用默认自增id,自己设定id</li>
<li>在每次插入之前都将AUTO_INCREMENT设置为1
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table_name <span style="color:#66d9ef">AUTO_INCREMENT</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
</code></pre></div></li>
</ul>
<h2 id="查询优化">查询优化</h2>
<h3 id="limitbetween等语句">limit、between等语句</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># sql-1
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> table_name <span style="color:#66d9ef">limit</span> index1,index2<span style="color:#f92672">-</span>index1;
<span style="color:#75715e"># sql-2
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> table_name
<span style="color:#66d9ef">WHERE</span> id <span style="color:#66d9ef">BETWEEN</span> index1 <span style="color:#66d9ef">AND</span> index2 <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">100</span>;
</code></pre></div><p>数据量比较大的话,<code>sql-2</code>的查询效率会比<code>sql-1</code>高很多,在数据量比较大的情况下一般使用between语句.</p>
<h2 id="查询表头信息">查询表头信息</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SHOW</span> COLUMNS <span style="color:#66d9ef">FROM</span> snatch.<span style="color:#f92672">`</span>jcy_prop<span style="color:#f92672">`</span>;
</code></pre></div>
</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script async src="//yihui.name/js/center-img.js"></script>
  
  <hr/>
  © <a href="https://imlauzh.github.io">Joseph Lau</a> 2017 &ndash; 2019 | <a href="https://github.com/imlauzh">Github</a>
  
  </footer>
  </body>
</html>

