<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.78.0" />

  <title> Markdown å›¾åºŠæ›´æ”¹åŠåšå®¢æ¨é€ |  GeekJoe</title>
  <meta name="description" content="A website built by Joseph Lau and host by Github pages.">
  <link rel="stylesheet" href="/blog/css/index.css">
  <link rel="stylesheet" href="/blog/css/classes.css">
  <link rel="canonical" href="/blog/note/markdown-%E5%9B%BE%E5%BA%8A%E6%9B%B4%E6%94%B9%E5%8F%8A%E5%8D%9A%E5%AE%A2%E6%8E%A8%E9%80%81/">
  <link rel="alternate" type="application/rss+xml" href="" title="GeekJoe">
  
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <header class="menus">
  

  <nav >
    
    <a href="/blog/"> Home</a>
    
    <a href="/blog/post/"> Posts</a>
    
    <a href="/blog/note/"> Notes</a>
    
    <a href="/blog/categories/"> Categories</a>
    
    <a href="/blog/tags/"> Tags</a>
    
    <a href="/blog/about/"> About</a>
    
    <a href="/blog/index.xml"> Subscribe</a>
    
  </nav>

  <nav class="fontawesome">
    
    
  </nav>
  
  
  <div class="hidden description">A website built by Joseph Lau and host by Github pages.</div>
  
</header>

<article id="article">
  <header>
  

    <h1 style="text-align: center;" >Markdown å›¾åºŠæ›´æ”¹åŠåšå®¢æ¨é€</h1>
    <div class="post-meta">
    
      <time datetime="2019-05-01T10:43:45Z">May 01, 2019</time> &nbsp; 
    

     &nbsp;

    
    
    

    
      <i class="far fa-clock"></i>
      
      
      

      
        5 min
      
      11 s
      &nbsp;
    
    </div>
  </header>

  <blockquote>
<p>ç”±äº2019å¹´4æœˆä»½æ–°æµªå›¾åºŠå¼€å¯äº†é˜²ç›—é“¾åŠŸèƒ½ï¼ˆä¸ç¡®å®šï¼‰ï¼Œéƒ¨ç½²åˆ°pagesæœåŠ¡çš„å›¾ç‰‡å¤±æ•ˆï¼Œä¸ºäº†é˜²æ­¢å›¾ç‰‡èµ„æºä¸¢å¤±ï¼Œéœ€è¦åœ¨æœ¬åœ°ç•™ä¸€ä»½å¤‡ä»½ï¼Œä½†æ˜¯æœ¬åœ°çš„å›¾ç‰‡åœ¨çº¿åšå®¢æ— æ³•æ˜¾ç¤ºï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦é‡æ–°æ‰¾ä¸€ä¸ªç›®å‰å¯ä»¥ä½¿ç”¨çš„å›¾åºŠä»¥åŠå›¾åºŠå·¥å…·ã€‚</p>
</blockquote>
<h2 id="å›¾åºŠé€‰æ‹©">å›¾åºŠé€‰æ‹©</h2>
<ul>
<li>
<p>ä¸ƒç‰›äº‘å­˜å‚¨ç”±äºéœ€è¦ä¸Šä¼ èº«ä»½éªŒè¯ï¼Œä¸ªäººæ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥ä¸è€ƒè™‘è¿™ä¸ªé€‰é¡¹</p>
</li>
<li>
<p>è…¾è®¯äº‘cosåªæœ‰7ä¸ªæœˆçš„å…è´¹æ—¶é—´ï¼Œåœ¨çº¿åšå®¢æœ¬æ¥å°±æ˜¯ç™½å«–çš„ï¼Œä¹Ÿæ²¡å¤šå°‘äººçœ‹ï¼Œæˆ‘å¤§éƒ¨åˆ†æ—¶é—´è¿˜æ˜¯çœ‹æœ¬åœ°æ–‡æ¡£ï¼Œæ‰€ä»¥ä¹Ÿä¸è€ƒè™‘</p>
</li>
<li>
<p>é˜¿é‡Œäº‘ossä¸è…¾è®¯äº‘ç±»ä¼¼ï¼Œè€Œä¸”æ›´è´µ</p>
</li>
<li>
<p>SM.MSï¼ŒV2EXç½‘å‹æä¾›ç»´æŠ¤ï¼Œä¸é™åˆ¶æµé‡ï¼Œä¸é™åˆ¶å…¬ç½‘åŸŸåï¼Œåªæœ‰ä¸Šä¼ æ–‡ä»¶é¢‘ç‡é™åˆ¶ï¼Œåªæ˜¯æ¯”è¾ƒæ‹…å¿ƒä»€ä¹ˆæ—¶å€™ä¼šåœæ­¢ç»´æŠ¤ï¼Œæ¯•ç«Ÿæ²¡æœ‰æ”¶å…¥æ¥æºï¼Œè¦æ˜¯å¤§ä½¬é’±å¤šé‚£å°±å½“æˆ‘æ²¡è¯´</p>
</li>
</ul>
<p>æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯SM.MSå›¾åºŠï¼Œè™½ç„¶æœ‰ç‚¹æ‹…å¿ƒåç»­ç»´æŠ¤ï¼Œä½†æ˜¯å¯¹äºç›®å‰æ¥è¯´ï¼Œè¿™ä¸ªç®—æ˜¯æœ€ä¼˜è§£äº†ã€‚</p>
<p>SM.MSæä¾›äº†APIï¼Œä¸€å°æ—¶å†…å¯ä»¥ä¸Šä¼ 100å¼ å›¾ç‰‡ï¼Œè¿™ä¸ªé¢‘ç‡ä¸€èˆ¬äººè¾¾ä¸åˆ°å§ï¼Œé™¤éä½ æ˜¯æƒ³æŠŠè¿™ä¸ªå½“æˆäº‘ç›˜å­˜ä½ çš„ç…§ç‰‡ï¼Œä¸è¿‡å‚»å­æ‰ä¼šæŠŠç§äººç…§ç‰‡ä¸Šä¼ åˆ°å›¾åºŠå•Šï¼Œè‰³ç…§é—¨æ˜¯æ€ä¹ˆæ¥çš„å•Šï¼å°ä¼™å­/å°å§‘å¨˜ä»¬ï¼</p>
<h2 id="å›¾åºŠå·¥å…·">å›¾åºŠå·¥å…·</h2>
<p>ç›®å‰æ¥è¯´macç«¯çš„å›¾åºŠå·¥å…·åšçš„æ¯”è¾ƒå¥½çš„å°±æ˜¯ipicäº†ï¼Œä½†æ˜¯è¿™è´§å…è´¹ç‰ˆåªæ”¯æŒæ–°æµªï¼Œæ–°æµªå‘¢åˆå¼€å¯äº†é˜²ç›—é“¾ï¼Œä»˜è´¹ç‰ˆå‘¢ä¹Ÿä¸æ”¯æŒSM.MS</p>
<p>ç„¶åæˆ‘å°±æƒ³é€šè¿‡Alfred workflowæ¥ä½œä¸ºå›¾åºŠå·¥å…·ï¼Œè‡ªåŠ¨è·å–å‰ªåˆ‡æ¿çš„å›¾ç‰‡ï¼Œç„¶ååˆ©ç”¨APIè½¬æ¢æˆé“¾æ¥ï¼Œæ”¾åˆ°å‰ªåˆ‡æ¿é‡Œï¼Œæˆ‘å°±åˆæ‰¾äº†åŠå¤©ï¼Œåˆæ˜¯rubyï¼Œåˆæ˜¯PHPï¼Œåˆæ˜¯pythonï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜æ€ä¹ˆéƒ½ä¸æˆåŠŸï¼Œæ°”ï¼</p>
<p>ç´¢æ€§æˆ‘å°±è‡ªå·±å†™äº†ä¸€ä¸ªè½®å­ï¼ŒæŠŠåŸå…ˆmarkdownæ–‡ä»¶é‡Œçš„æ–°æµªå›¾åºŠé“¾æ¥ä¸‹è½½æˆå›¾ç‰‡ï¼Œå†ç”¨APIè½¬æˆSMMSé“¾æ¥</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> re
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> urllib.request
<span style="color:#f92672">from</span> urllib.request <span style="color:#f92672">import</span> urlretrieve
<span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
header <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;Accept&#34;</span>:
    <span style="color:#e6db74">&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#34;</span>,
    <span style="color:#e6db74">&#34;Accept-Encoding&#34;</span>:
    <span style="color:#e6db74">&#34;gzip, deflate&#34;</span>,
    <span style="color:#e6db74">&#34;Accept-Language&#34;</span>:
    <span style="color:#e6db74">&#34;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&#34;</span>,
    <span style="color:#e6db74">&#34;Cache-Control&#34;</span>:
    <span style="color:#e6db74">&#34;max-age=0&#34;</span>,
    <span style="color:#e6db74">&#34;DNT&#34;</span>:
    <span style="color:#e6db74">&#34;1&#34;</span>,
    <span style="color:#e6db74">&#34;Host&#34;</span>:
    <span style="color:#e6db74">&#34;ws1.sinaimg.cn&#34;</span>,
    <span style="color:#e6db74">&#34;If-Modified-Since&#34;</span>:
    <span style="color:#e6db74">&#34;Mon, 08 Jul 2013 18:06:40 GMT&#34;</span>,
    <span style="color:#e6db74">&#34;Proxy-Connection&#34;</span>:
    <span style="color:#e6db74">&#34;keep-alive&#34;</span>,
    <span style="color:#e6db74">&#34;Upgrade-Insecure-Requests&#34;</span>:
    <span style="color:#e6db74">&#34;1&#34;</span>,
    <span style="color:#e6db74">&#34;User-Agent&#34;</span>:
    <span style="color:#e6db74">&#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36&#34;</span>
}


<span style="color:#75715e"># find markdown files in filesPath</span>
<span style="color:#75715e"># list files</span>
<span style="color:#75715e"># get the whole files path</span>
<span style="color:#75715e"># decide the files are md file or not</span>
<span style="color:#75715e"># return markdown files list</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find_MD</span>(filesPath):
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(filesPath):
        <span style="color:#66d9ef">return</span>
    filesList <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>listdir(filesPath)
    MDFileList <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> filesList:
        filePath <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(filesPath, file)
        <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isfile(filePath) <span style="color:#f92672">and</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>splitext(filePath)[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.md&#39;</span>:
            MDFileList<span style="color:#f92672">.</span>append(filePath)
    <span style="color:#66d9ef">return</span> MDFileList


<span style="color:#75715e"># download pics through url</span>
<span style="color:#75715e"># generate files&#39; name in filespath</span>
<span style="color:#75715e"># get pics&#39; content</span>
<span style="color:#75715e"># write the content to file</span>
<span style="color:#75715e"># return saved pic path</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">downloadPic</span>(link, savePath):
    picPath <span style="color:#f92672">=</span> savePath <span style="color:#f92672">+</span> link<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;.&#39;</span>)[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> str(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.&#39;</span> <span style="color:#f92672">+</span> link<span style="color:#f92672">.</span>split(
        <span style="color:#e6db74">&#39;.&#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
    pic_html <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(link, stream<span style="color:#f92672">=</span>True)
    <span style="color:#66d9ef">with</span> open(picPath, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> pic:
        pic<span style="color:#f92672">.</span>write(pic_html<span style="color:#f92672">.</span>content)
    <span style="color:#75715e"># urlretrieve(link, picPath)</span>
    <span style="color:#66d9ef">return</span> picPath


<span style="color:#75715e"># upload pics using sm.ms</span>
<span style="color:#75715e"># using sm.ms api</span>
<span style="color:#75715e"># return cloud path</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">smmsUpload</span>(imgOriginPath):
    <span style="color:#66d9ef">try</span>:
        smmsUrl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
        data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(
            smmsUrl,
            files<span style="color:#f92672">=</span>{
                <span style="color:#e6db74">&#39;smfile&#39;</span>: open(imgOriginPath, <span style="color:#e6db74">&#39;rb&#39;</span>),
                <span style="color:#e6db74">&#39;format&#39;</span>: <span style="color:#e6db74">&#39;json&#39;</span>
            })
        img_new_url <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(data<span style="color:#f92672">.</span>text)
        cloud_path <span style="color:#f92672">=</span> img_new_url[<span style="color:#e6db74">&#39;data&#39;</span>][<span style="color:#e6db74">&#39;url&#39;</span>]
        <span style="color:#66d9ef">return</span> (cloud_path)
    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">BaseException</span> <span style="color:#66d9ef">as</span> err:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;error in smms</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{}&#34;</span><span style="color:#f92672">.</span>format(err))


<span style="color:#75715e"># rewrite markdown files</span>
<span style="color:#75715e"># save files</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">MDRewrite</span>(MDFilePath, MDContent):
    <span style="color:#66d9ef">with</span> open(MDFilePath, <span style="color:#e6db74">&#39;w&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> md:
        md<span style="color:#f92672">.</span>write(MDContent)


<span style="color:#75715e"># change pic blocks from sinaimg to smms</span>
<span style="color:#75715e"># using re to find sinaimg urls</span>
<span style="color:#75715e"># download pic from sinaimg</span>
<span style="color:#75715e"># upload pics to sm.ms and get cloud url</span>
<span style="color:#75715e"># rewrite markdown files content and save</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">picBlockParser</span>(MDFilePath):
    <span style="color:#66d9ef">try</span>:
        picUrl_re <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">&#39;&#39;</span>)
        <span style="color:#66d9ef">with</span> open(MDFilePath) <span style="color:#66d9ef">as</span> md:
            MDContent <span style="color:#f92672">=</span> md<span style="color:#f92672">.</span>read()
            picUrl <span style="color:#f92672">=</span> picUrl_re<span style="color:#f92672">.</span>findall(MDContent)
            <span style="color:#66d9ef">if</span> len(picUrl) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
                <span style="color:#66d9ef">print</span>(MDFilePath)
                <span style="color:#75715e"># print(len(picUrl))</span>
                <span style="color:#75715e"># print(picUrl)</span>
                <span style="color:#66d9ef">for</span> Url <span style="color:#f92672">in</span> picUrl:
                    picPath <span style="color:#f92672">=</span> downloadPic(Url,<span style="color:#e6db74">&#39;pic/&#39;</span>)
                    <span style="color:#66d9ef">print</span>(Url)
                    smmsUrl <span style="color:#f92672">=</span> smmsUpload(picPath)
                    <span style="color:#66d9ef">print</span>(smmsUrl)
                    MDContent <span style="color:#f92672">=</span> MDContent<span style="color:#f92672">.</span>replace(Url, smmsUrl)
                MDRewrite(MDFilePath, MDContent)
                <span style="color:#66d9ef">print</span>(MDFilePath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;æ›¿æ¢æˆåŠŸ&#39;</span>)
    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">BaseException</span> <span style="color:#66d9ef">as</span> err:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;{}&#34;</span><span style="color:#f92672">.</span>format(err))


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    <span style="color:#66d9ef">for</span> page <span style="color:#f92672">in</span> find_MD(<span style="color:#e6db74">&#39;/_posts&#39;</span>):
        picBlockList <span style="color:#f92672">=</span> picBlockParser(page)

</code></pre></div><h2 id="åšå®¢æ¨é€">åšå®¢æ¨é€</h2>
<p>ç”±äºå›¾åºŠå·¥å…·ä½¿ç”¨pythonæ¥å®ç°ï¼Œé‚£ä¹ˆå°±åœ¨æ¨é€ä¹‹å‰å°†markdownä¸­çš„æœ¬åœ°å›¾ç‰‡åœ°å€ï¼Œè½¬åŒ–æˆsmmsé“¾æ¥ï¼Œå†è¿›è¡Œæ¨é€ï¼Œè¿™æ ·ä»¥åæ›´æ”¹å›¾åºŠæ¯”è¾ƒæ–¹ä¾¿ï¼Œåªéœ€è¦æ›´æ”¹APIå®ç°æ–¹å¼å°±ğŸ‘Œã€‚</p>
<p>å…·ä½“å®ç°æ–¹å¼ä¸ä¸Šè¿°ä»£ç ç±»ä¼¼ï¼Œåœ¨æ­¤ä¸åœ¨èµ˜è¿°ã€‚</p>
<p>æ”¾å‡ å¼ ç¾ç›¾å’Œé’¢é“ä¾ çš„æµ·æŠ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p><img src="https://i.loli.net/2019/05/01/5cc9193977d28.jpg" alt="Captain America- The First Avenger-1"></p>
<p><img src="https://i.loli.net/2019/05/01/5cc91650afbb3.jpg" alt="Captain America- The First Avenger-2"></p>
<p><img src="https://i.loli.net/2019/05/01/5cc916f86a377.jpg" alt="Iron Man"></p>
<p><img src="https://i.loli.net/2019/05/01/5cc9193a75b6d.jpg" alt="Marvel&rsquo;s The Avengers-1"></p>
<p><img src="https://i.loli.net/2019/05/01/5cc9193e75cc9.jpg" alt="Avengers- Age of Ultron"></p>

  
  <footer>
    <hr>
    
    <div class="post-tags">
    
      <i class="fas fa-tags"></i>
      
        <a href="/blog/tags/blog">Blog</a>
        &nbsp;
      
    
    </div>
  </footer>
  

  


  <div class="comments">



</div>

</article>



  
  
  
</body>
<div class="foot">
  
  
    &copy; 2017 - 2020 &#183; 
    <a href="/">Home</a> Â· Theme <a href="https://github.com/RainerChiang/simpleness">Simpleness</a> Powered by <a href="https://gohugo.io/">Hugo</a> &#183;
    <a href="#"><i class="fas fa-chevron-up"></i></a>
  

  
</div>

<script src="/blog/js/lazyload.min.js"></script>
<script>
  var lazyImage = new LazyLoad({
    container: document.getElementById('article')
  });
</script>


</html>
