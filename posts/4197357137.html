<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="default">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">























  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link rel="stylesheet" href="https://fonts.css.network//css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Monaco:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon32.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon16.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Migrating to Python 3 with pleasure Migrating to Python 3 with pleasure">
<meta name="keywords" content="Python,Reproduce">
<meta property="og:type" content="article">
<meta property="og:title" content="Migrating to Python 3 with pleasure">
<meta property="og:url" content="https://jacksonleon.gitee.io/posts/4197357137.html">
<meta property="og:site_name" content="GeekJoe">
<meta property="og:description" content="Migrating to Python 3 with pleasure Migrating to Python 3 with pleasure">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://uploads.toptal.io/blog/image/92216/toptal-blog-image-1457618659472-be2f380fe3aad41333427ecd5a1ec5c5.jpg">
<meta property="og:image" content="https://jacksonleon.gitee.io/posts/images/pycharm-type-hinting.png">
<meta property="og:image" content="https://jacksonleon.gitee.io/posts/images/variable_annotations.png">
<meta property="og:image" content="https://uploads.toptal.io/blog/image/92216/toptal-blog-image-1457618659472-be2f380fe3aad41333427ecd5a1ec5c5.jpg">
<meta property="og:image" content="https://jacksonleon.gitee.io/posts/images/pycharm-type-hinting.png">
<meta property="og:image" content="https://jacksonleon.gitee.io/posts/images/variable_annotations.png">
<meta property="og:updated_time" content="2019-05-04T01:30:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Migrating to Python 3 with pleasure">
<meta name="twitter:description" content="Migrating to Python 3 with pleasure Migrating to Python 3 with pleasure">
<meta name="twitter:image" content="https://uploads.toptal.io/blog/image/92216/toptal-blog-image-1457618659472-be2f380fe3aad41333427ecd5a1ec5c5.jpg">



  <link rel="alternate" href="/atom.xml" title="GeekJoe" type="application/atom+xml">




  <link rel="canonical" href="https://jacksonleon.gitee.io/posts/4197357137.html">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Migrating to Python 3 with pleasure | GeekJoe</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-133178853-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-133178853-1');
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/JacksonLeon" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">GeekJoe</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">步子大了容易扯着蛋</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-notes">

    
    
    
      
    

    

    <a href="/notes/" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i> <br>Notes</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-friends">

    
    
    
      
    

    

    <a href="/friends/" rel="section"><i class="menu-item-icon fa fa-fw fa-address-book"></i> <br>Friends</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jacksonleon.gitee.io/posts/4197357137.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph">
      <meta itemprop="description" content="Love what you do, do what you love.">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GeekJoe">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Migrating to Python 3 with pleasure

              
            
          </h1>
        

        <div class="post-meta">
          
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-04 09:30:29" itemprop="dateCreated datePublished" datetime="2019-05-04T09:30:29+08:00">2019-05-04</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <a href="/posts/4197357137.html#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/posts/4197357137.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             Views:  
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">48k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">43 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Migrating-to-Python-3-with-pleasure"><a href="#Migrating-to-Python-3-with-pleasure" class="headerlink" title="Migrating to Python 3 with pleasure"></a>Migrating to Python 3 with pleasure</h1><blockquote>
<p>Migrating to Python 3 with pleasure</p>
</blockquote>
<a id="more"></a>
<h1 id="English-version"><a href="#English-version" class="headerlink" title="English version"></a>English version</h1><h2 id="A-short-guide-on-features-of-Python-3-for-data-scientists"><a href="#A-short-guide-on-features-of-Python-3-for-data-scientists" class="headerlink" title="A short guide on features of Python 3 for data scientists"></a>A short guide on features of Python 3 for data scientists</h2><p>Python became a mainstream language for machine learning and other scientific fields that heavily operate with data;<br>it boasts various deep learning frameworks and well-established set of tools for data processing and visualization.</p>
<p>However, Python ecosystem co-exists in Python 2 and Python 3, and Python 2 is still used among data scientists.<br>By the end of 2019 the scientific stack will <a href="http://www.python3statement.org" target="_blank" rel="noopener">stop supporting Python2</a>.<br>As for numpy, after 2018 any new feature releases will only support <a href="https://github.com/numpy/numpy/blob/master/doc/neps/dropping-python2.7-proposal.rst" target="_blank" rel="noopener">Python3</a>. <em>Update (Sep 2018): same story now with pandas, matplotlib, ipython, jupyter notebook and jupyter lab.</em></p>
<p>To make the transition less frustrating, I’ve collected a bunch of Python 3 features that you may find useful.</p>
<p><img src="https://uploads.toptal.io/blog/image/92216/toptal-blog-image-1457618659472-be2f380fe3aad41333427ecd5a1ec5c5.jpg" width="400"></p>
<p>Image from <a href="https://www.toptal.com/python/python-3-is-it-worth-the-switch" target="_blank" rel="noopener">Dario Bertini post (toptal)</a></p>
<h2 id="Better-paths-handling-with-pathlib"><a href="#Better-paths-handling-with-pathlib" class="headerlink" title="Better paths handling with pathlib"></a>Better paths handling with <code>pathlib</code></h2><p><code>pathlib</code> is a default module in python3, that helps you to avoid tons of <code>os.path.join</code>s:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">dataset = <span class="string">'wiki_images'</span></span><br><span class="line">datasets_root = Path(<span class="string">'/path/to/datasets/'</span>)</span><br><span class="line"></span><br><span class="line">train_path = datasets_root / dataset / <span class="string">'train'</span></span><br><span class="line">test_path = datasets_root / dataset / <span class="string">'test'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> image_path <span class="keyword">in</span> train_path.iterdir():</span><br><span class="line">    <span class="keyword">with</span> image_path.open() <span class="keyword">as</span> f: <span class="comment"># note, open is a method of Path object</span></span><br><span class="line">        <span class="comment"># do something with an image</span></span><br></pre></td></tr></table></figure>
<p>Previously it was always tempting to use string concatenation (concise, but obviously bad),<br>now with <code>pathlib</code> the code is safe, concise, and readable.</p>
<p>Also <code>pathlib.Path</code> has a bunch of methods and properties, that every python novice previously had to google:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p.exists()</span><br><span class="line">p.is_dir()</span><br><span class="line">p.parts</span><br><span class="line">p.with_name(<span class="string">'sibling.png'</span>) <span class="comment"># only change the name, but keep the folder</span></span><br><span class="line">p.with_suffix(<span class="string">'.jpg'</span>) <span class="comment"># only change the extension, but keep the folder and the name</span></span><br><span class="line">p.chmod(mode)</span><br><span class="line">p.rmdir()</span><br></pre></td></tr></table></figure>
<p><code>pathlib</code> should save you lots of time,<br>please see <a href="https://docs.python.org/3/library/pathlib.html" target="_blank" rel="noopener">docs</a> and <a href="https://pymotw.com/3/pathlib/" target="_blank" rel="noopener">reference</a> for more.</p>
<h2 id="Type-hinting-is-now-part-of-the-language"><a href="#Type-hinting-is-now-part-of-the-language" class="headerlink" title="Type hinting is now part of the language"></a>Type hinting is now part of the language</h2><p>Example of type hinting in pycharm: <br><br><img src="images/pycharm-type-hinting.png"></p>
<p>Python is not just a language for small scripts anymore,<br>data pipelines these days include numerous steps each involving different frameworks (and sometimes very different logic).</p>
<p>Type hinting was introduced to help with growing complexity of programs, so machines could help with code verification.<br>Previously different modules used custom ways to point <a href="https://www.jetbrains.com/help/pycharm/type-hinting-in-pycharm.html#legacy" target="_blank" rel="noopener">types in docstrings</a><br>(Hint: pycharm can convert old docstrings to fresh type hinting).</p>
<p>As a simple example, the following code may work with different types of data (that’s what we like about python data stack).<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat_each_entry</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="string">""" Each entry in the data is doubled</span></span><br><span class="line"><span class="string">    &lt;blah blah nobody reads the documentation till the end&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    index = numpy.repeat(numpy.arange(len(data)), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> data[index]</span><br></pre></td></tr></table></figure></p>
<p>This code e.g. works for <code>numpy.array</code> (incl. multidimensional ones), <code>astropy.Table</code> and <code>astropy.Column</code>, <code>bcolz</code>, <code>cupy</code>, <code>mxnet.ndarray</code> and others.</p>
<p>This code will work for <code>pandas.Series</code>, but in the wrong way:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repeat_each_entry(pandas.Series(data=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], index=[<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])) <span class="comment"># returns Series with Nones inside</span></span><br></pre></td></tr></table></figure></p>
<p>This was two lines of code. Imagine how unpredictable behavior of a complex system, because just one function may misbehave.<br>Stating explicitly which types a method expects is very helpful in large systems, this will warn you if a function was passed unexpected arguments.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat_each_entry</span><span class="params">(data: Union[numpy.ndarray, bcolz.carray])</span>:</span></span><br></pre></td></tr></table></figure>
<p>If you have a significant codebase, hinting tools like <a href="http://mypy.readthedocs.io" target="_blank" rel="noopener">MyPy</a> are likely to become part of your continuous integration pipeline.<br>A webinar <a href="https://www.youtube.com/watch?v=JqBCFfiE11g" target="_blank" rel="noopener">“Putting Type Hints to Work”</a> by Daniel Pyrathon is good for a brief introduction.</p>
<p>Sidenote: unfortunately, hinting is not yet powerful enough to provide fine-grained typing for ndarrays/tensors, but <a href="https://github.com/numpy/numpy/issues/7370" target="_blank" rel="noopener">maybe we’ll have it once</a>, and this will be a great feature for DS.</p>
<h2 id="Type-hinting-→-type-checking-in-runtime"><a href="#Type-hinting-→-type-checking-in-runtime" class="headerlink" title="Type hinting → type checking in runtime"></a>Type hinting → type checking in runtime</h2><p>By default, function annotations do not influence how your code is working, but merely help you to point code intentions.</p>
<p>However, you can enforce type checking in runtime with tools like … <a href="https://github.com/RussBaz/enforce" target="_blank" rel="noopener">enforce</a>,<br>this can help you in debugging (there are many cases when type hinting is not working).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@enforce.runtime_validation</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(text: str)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    print(text)</span><br><span class="line"></span><br><span class="line">foo(<span class="string">'Hi'</span>) <span class="comment"># ok</span></span><br><span class="line">foo(<span class="number">5</span>)    <span class="comment"># fails</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@enforce.runtime_validation</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">any2</span><span class="params">(x: List[bool])</span> -&gt; bool:</span></span><br><span class="line">    <span class="keyword">return</span> any(x)</span><br><span class="line"></span><br><span class="line">any ([<span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">False</span>]) <span class="comment"># True</span></span><br><span class="line">any2([<span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">False</span>]) <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">any ([<span class="string">'False'</span>]) <span class="comment"># True</span></span><br><span class="line">any2([<span class="string">'False'</span>]) <span class="comment"># fails</span></span><br><span class="line"></span><br><span class="line">any ([<span class="literal">False</span>, <span class="literal">None</span>, <span class="string">""</span>, <span class="number">0</span>]) <span class="comment"># False</span></span><br><span class="line">any2([<span class="literal">False</span>, <span class="literal">None</span>, <span class="string">""</span>, <span class="number">0</span>]) <span class="comment"># fails</span></span><br></pre></td></tr></table></figure>
<h2 id="Other-usages-of-function-annotations"><a href="#Other-usages-of-function-annotations" class="headerlink" title="Other usages of function annotations"></a><strike>Other usages of function annotations</strike></h2><p><em>Update: starting from python 3.7 this behavior was <a href="https://www.python.org/dev/peps/pep-0563/#non-typing-usage-of-annotations" target="_blank" rel="noopener">depreciated</a>, and function annotations should be used for type hinting only. Python 4 will not support other usages of annotations.</em></p>
<p>As mentioned before, annotations do not influence code execution, but rather provide some meta-information,<br>and you can use it as you wish.</p>
<p>For instance, measurement units are a common pain in scientific areas, <code>astropy</code> package <a href="http://docs.astropy.org/en/stable/units/quantity.html#functions-that-accept-quantities" target="_blank" rel="noopener">provides a simple decorator</a> to control units of input quantities and convert output to required units<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line"><span class="keyword">from</span> astropy <span class="keyword">import</span> units <span class="keyword">as</span> u</span><br><span class="line"><span class="meta">@u.quantity_input()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">frequency</span><span class="params">(speed: u.meter / u.s, wavelength: u.nm)</span> -&gt; u.terahertz:</span></span><br><span class="line">    <span class="keyword">return</span> speed / wavelength</span><br><span class="line"></span><br><span class="line">frequency(speed=<span class="number">300</span>_000 * u.km / u.s, wavelength=<span class="number">555</span> * u.nm)</span><br><span class="line"><span class="comment"># output: 540.5405405405404 THz, frequency of green visible light</span></span><br></pre></td></tr></table></figure></p>
<p>If you’re processing tabular scientific data in python (not necessarily astronomical), you should give <code>astropy</code> a shot.</p>
<p>You can also define your application-specific decorators to perform control / conversion of inputs and output in the same manner.</p>
<h2 id="Matrix-multiplication-with"><a href="#Matrix-multiplication-with" class="headerlink" title="Matrix multiplication with @"></a>Matrix multiplication with @</h2><p>Let’s implement one of the simplest ML models &mdash; a linear regression with l2 regularization (a.k.a. ridge regression):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># l2-regularized linear regression: || AX - y ||^2 + alpha * ||x||^2 -&gt; min</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">X = np.linalg.inv(np.dot(A.T, A) + alpha * np.eye(A.shape[<span class="number">1</span>])).dot(A.T.dot(y))</span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">X = np.linalg.inv(A.T @ A + alpha * np.eye(A.shape[<span class="number">1</span>])) @ (A.T @ y)</span><br></pre></td></tr></table></figure>
<p>The code with <code>@</code> becomes more readable and more translatable between deep learning frameworks: same code <code>X @ W + b[None, :]</code> for a single layer of perceptron works in <code>numpy</code>, <code>cupy</code>, <code>pytorch</code>, <code>tensorflow</code> (and other frameworks that operate with tensors).</p>
<h2 id="Globbing-with"><a href="#Globbing-with" class="headerlink" title="Globbing with **"></a>Globbing with <code>**</code></h2><p>Recursive folder globbing is not easy in Python 2, even though the <a href="https://github.com/miracle2k/python-glob2" target="_blank" rel="noopener">glob2</a> custom module exists that overcomes this. A recursive flag is supported since Python 3.5:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">found_images = (</span><br><span class="line">    glob.glob(<span class="string">'/path/*.jpg'</span>)</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*.jpg'</span>)</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*/*.jpg'</span>)</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*/*/*.jpg'</span>)</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*/*/*/*.jpg'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">found_images = glob.glob(<span class="string">'/path/**/*.jpg'</span>, recursive=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>A better option is to use <code>pathlib</code> in python3 (minus one import!):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">found_images = pathlib.Path(<span class="string">'/path/'</span>).glob(<span class="string">'**/*.jpg'</span>)</span><br></pre></td></tr></table></figure></p>
<p>Note: there are <a href="https://github.com/arogozhnikov/python3_with_pleasure/issues/16" target="_blank" rel="noopener">minor differences</a> between <code>glob.glob</code>, <code>Path.glob</code> and bash globbing.</p>
<h2 id="Print-is-a-function-now"><a href="#Print-is-a-function-now" class="headerlink" title="Print is a function now"></a>Print is a function now</h2><p>Yes, code now has these annoying parentheses, but there are some advantages:</p>
<ul>
<li><p>simple syntax for using file descriptor:</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> &gt;&gt;sys.stderr, <span class="string">"critical error"</span>      <span class="comment"># Python 2</span></span><br><span class="line">print(<span class="string">"critical error"</span>, file=sys.stderr)  <span class="comment"># Python 3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>printing tab-aligned tables without <code>str.join</code>:</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">print(*array, sep=<span class="string">'\t'</span>)</span><br><span class="line">print(batch, epoch, loss, accuracy, time, sep=<span class="string">'\t'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>hacky suppressing / redirection of printing output:</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">_print = <span class="keyword">print</span> <span class="comment"># store the original print function</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print</span><span class="params">(*args, **kargs)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># do something useful, e.g. store output to some file</span></span><br></pre></td></tr></table></figure>
<p>  In jupyter it is desirable to log each output to a separate file (to track what’s happening after you got disconnected), so you can override <code>print</code> now.</p>
<p>  Below you can see a context manager that temporarily overrides behavior of print:</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replace_print</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> builtins</span><br><span class="line">    _print = <span class="keyword">print</span> <span class="comment"># saving old print function</span></span><br><span class="line">    <span class="comment"># or use some other function here</span></span><br><span class="line">    builtins.<span class="keyword">print</span> = <span class="keyword">lambda</span> *args, **kwargs: _print(<span class="string">'new printing'</span>, *args, **kwargs)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    builtins.<span class="keyword">print</span> = _print</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> replace_print():</span><br><span class="line">    &lt;code here will invoke other <span class="keyword">print</span> function&gt;</span><br></pre></td></tr></table></figure>
<p>  It is <em>not</em> a recommended approach, but a small dirty hack that is now possible.</p>
</li>
<li><code>print</code> can participate in list comprehensions and other language constructs  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">result = process(x) <span class="keyword">if</span> is_valid(x) <span class="keyword">else</span> print(<span class="string">'invalid item: '</span>, x)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Underscores-in-Numeric-Literal-Thousands-Separator"><a href="#Underscores-in-Numeric-Literal-Thousands-Separator" class="headerlink" title="Underscores in Numeric Literal (Thousands Separator)"></a>Underscores in Numeric Literal (Thousands Separator)</h2><p><a href="https://www.python.org/dev/peps/pep-0515/" title="PEP-515" target="_blank" rel="noopener">PEP-515</a> introduced underscores in Numeric Literals.<br>In Python3, underscores can be used to group digits visually in integral, floating-point, and complex number literals.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grouping decimal numbers by thousands</span></span><br><span class="line">one_million = <span class="number">1</span>_000_000</span><br><span class="line"></span><br><span class="line"><span class="comment"># grouping hexadecimal addresses by words</span></span><br><span class="line">addr = <span class="number">0xCAFE</span>_F00D</span><br><span class="line"></span><br><span class="line"><span class="comment"># grouping bits into nibbles in a binary literal</span></span><br><span class="line">flags = <span class="number">0</span>b_0011_1111_0100_1110</span><br><span class="line"></span><br><span class="line"><span class="comment"># same, for string conversions</span></span><br><span class="line">flags = int(<span class="string">'0b_1111_0000'</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h2 id="f-strings-for-simple-and-reliable-formatting"><a href="#f-strings-for-simple-and-reliable-formatting" class="headerlink" title="f-strings for simple and reliable formatting"></a>f-strings for simple and reliable formatting</h2><p>The default formatting system provides a flexibility that is not required in data experiments.<br>The resulting code is either too verbose or too fragile towards any changes.</p>
<p>Quite typically data scientists outputs some logging information iteratively in a fixed format.<br>It is common to have a code like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'&#123;batch:3&#125; &#123;epoch:3&#125; / &#123;total_epochs:3&#125;  accuracy: &#123;acc_mean:0.4f&#125;±&#123;acc_std:0.4f&#125; time: &#123;avg_time:3.2f&#125;'</span>.format(</span><br><span class="line">    batch=batch, epoch=epoch, total_epochs=total_epochs,</span><br><span class="line">    acc_mean=numpy.mean(accuracies), acc_std=numpy.std(accuracies),</span><br><span class="line">    avg_time=time / len(data_batch)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2 (too error-prone during fast modifications, please avoid):</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'&#123;:3&#125; &#123;:3&#125; / &#123;:3&#125;  accuracy: &#123;:0.4f&#125;±&#123;:0.4f&#125; time: &#123;:3.2f&#125;'</span>.format(</span><br><span class="line">    batch, epoch, total_epochs, numpy.mean(accuracies), numpy.std(accuracies),</span><br><span class="line">    time / len(data_batch)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Sample output:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">120  12 / 300  accuracy: 0.8180±0.4649 time: 56.60</span><br></pre></td></tr></table></figure></p>
<p><strong>f-strings</strong> aka formatted string literals were introduced in Python 3.6:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3.6+</span></span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;batch:<span class="number">3</span>&#125;</span> <span class="subst">&#123;epoch:<span class="number">3</span>&#125;</span> / <span class="subst">&#123;total_epochs:<span class="number">3</span>&#125;</span>  accuracy: <span class="subst">&#123;numpy.mean(accuracies):<span class="number">0.4</span>f&#125;</span>±<span class="subst">&#123;numpy.std(accuracies):<span class="number">0.4</span>f&#125;</span> time: <span class="subst">&#123;time / len(data_batch):<span class="number">3.2</span>f&#125;</span>'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="Explicit-difference-between-‘true-division’-and-‘floor-division’"><a href="#Explicit-difference-between-‘true-division’-and-‘floor-division’" class="headerlink" title="Explicit difference between ‘true division’ and ‘floor division’"></a>Explicit difference between ‘true division’ and ‘floor division’</h2><p>For data science this is definitely a handy change </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = pandas.read_csv(<span class="string">'timing.csv'</span>)</span><br><span class="line">velocity = data[<span class="string">'distance'</span>] / data[<span class="string">'time'</span>]</span><br></pre></td></tr></table></figure>
<p>Results in Python 2 depend on whether ‘time’ and ‘distance’ (e.g. measured in meters and seconds) are stored as integers.<br>In Python 3, the result is correct in both cases, because the result of division is float.</p>
<p>Another case is floor division, which is now an explicit operation:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n_gifts = money // gift_price  <span class="comment"># correct for int and float arguments</span></span><br></pre></td></tr></table></figure>
<p>In a nutshell:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> truediv, floordiv</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>truediv.__doc__, floordiv.__doc__</span><br><span class="line">(<span class="string">'truediv(a, b) -- Same as a / b.'</span>, <span class="string">'floordiv(a, b) -- Same as a // b.'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">3</span> / <span class="number">2</span>), (<span class="number">3</span> // <span class="number">2</span>), (<span class="number">3.0</span> // <span class="number">2.0</span>)</span><br><span class="line">(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">1.0</span>)</span><br></pre></td></tr></table></figure>
<p>Note, that this applies both to built-in types and to custom types provided by data packages (e.g. <code>numpy</code> or <code>pandas</code>).</p>
<h2 id="Strict-ordering"><a href="#Strict-ordering" class="headerlink" title="Strict ordering"></a>Strict ordering</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># All these comparisons are illegal in Python 3</span></span><br><span class="line"><span class="number">3</span> &lt; <span class="string">'3'</span></span><br><span class="line"><span class="number">2</span> &lt; <span class="literal">None</span></span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>) &lt; (<span class="number">3</span>, <span class="literal">None</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>) &lt; [<span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># False in both Python 2 and Python 3</span></span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>) == [<span class="number">4</span>, <span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>prevents from occasional sorting of instances of different types</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sorted([<span class="number">2</span>, <span class="string">'1'</span>, <span class="number">3</span>])  <span class="comment"># invalid for Python 3, in Python 2 returns [2, 3, '1']</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>helps to spot some problems that arise when processing raw data</p>
</li>
</ul>
<p>Sidenote: proper check for None is (in both Python versions)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> a <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> a: <span class="comment"># WRONG check for None</span></span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Unicode-for-NLP"><a href="#Unicode-for-NLP" class="headerlink" title="Unicode for NLP"></a>Unicode for NLP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'您好'</span></span><br><span class="line">print(len(s))</span><br><span class="line">print(s[:<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<ul>
<li>Python 2: <code>6\n��</code></li>
<li>Python 3: <code>2\n您好</code>.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="string">u'со'</span></span><br><span class="line">x += <span class="string">'co'</span> <span class="comment"># ok</span></span><br><span class="line">x += <span class="string">'со'</span> <span class="comment"># fail</span></span><br></pre></td></tr></table></figure>
<p>Python 2 fails, Python 3 works as expected (because I’ve used russian letters in strings).</p>
<p>In Python 3 <code>str</code>s are unicode strings, and it is more convenient for NLP processing of non-english texts.</p>
<p>There are other funny things, for instance:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'a'</span> &lt; type &lt; <span class="string">u'a'</span>  <span class="comment"># Python 2: True</span></span><br><span class="line"><span class="string">'a'</span> &lt; <span class="string">u'a'</span>         <span class="comment"># Python 2: False</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">Counter(<span class="string">'Möbelstück'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Python 2: <code>Counter({&#39;\xc3&#39;: 2, &#39;b&#39;: 1, &#39;e&#39;: 1, &#39;c&#39;: 1, &#39;k&#39;: 1, &#39;M&#39;: 1, &#39;l&#39;: 1, &#39;s&#39;: 1, &#39;t&#39;: 1, &#39;\xb6&#39;: 1, &#39;\xbc&#39;: 1})</code></li>
<li>Python 3: <code>Counter({&#39;M&#39;: 1, &#39;ö&#39;: 1, &#39;b&#39;: 1, &#39;e&#39;: 1, &#39;l&#39;: 1, &#39;s&#39;: 1, &#39;t&#39;: 1, &#39;ü&#39;: 1, &#39;c&#39;: 1, &#39;k&#39;: 1})</code></li>
</ul>
<p>You can handle all of this in Python 2 properly, but Python 3 is more friendly.</p>
<h2 id="Preserving-order-of-dictionaries-and-kwargs"><a href="#Preserving-order-of-dictionaries-and-kwargs" class="headerlink" title="Preserving order of dictionaries and **kwargs"></a>Preserving order of dictionaries and **kwargs</h2><p>In CPython 3.6+ dicts behave like <code>OrderedDict</code> by default (and <a href="https://stackoverflow.com/questions/39980323/are-dictionaries-ordered-in-python-3-6" target="_blank" rel="noopener">this is guaranteed in Python 3.7+</a>).<br>This preserves order during dict comprehensions (and other operations, e.g. during json serialization/deserialization)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">x = &#123;str(i):i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)&#125;</span><br><span class="line">json.loads(json.dumps(x))</span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">&#123;<span class="string">u'1'</span>: <span class="number">1</span>, <span class="string">u'0'</span>: <span class="number">0</span>, <span class="string">u'3'</span>: <span class="number">3</span>, <span class="string">u'2'</span>: <span class="number">2</span>, <span class="string">u'4'</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">&#123;<span class="string">'0'</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">2</span>, <span class="string">'3'</span>: <span class="number">3</span>, <span class="string">'4'</span>: <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure>
<p>Same applies to <code>**kwargs</code> (in Python 3.6+), they’re kept in the same order as they appear in parameters.<br>Order is crucial when it comes to data pipelines, previously we had to write it in a cumbersome manner:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">model = nn.Sequential(OrderedDict([</span><br><span class="line">          (<span class="string">'conv1'</span>, nn.Conv2d(<span class="number">1</span>,<span class="number">20</span>,<span class="number">5</span>)),</span><br><span class="line">          (<span class="string">'relu1'</span>, nn.ReLU()),</span><br><span class="line">          (<span class="string">'conv2'</span>, nn.Conv2d(<span class="number">20</span>,<span class="number">64</span>,<span class="number">5</span>)),</span><br><span class="line">          (<span class="string">'relu2'</span>, nn.ReLU())</span><br><span class="line">        ]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3.6+, how it *can* be done, not supported right now in pytorch</span></span><br><span class="line">model = nn.Sequential(</span><br><span class="line">    conv1=nn.Conv2d(<span class="number">1</span>,<span class="number">20</span>,<span class="number">5</span>),</span><br><span class="line">    relu1=nn.ReLU(),</span><br><span class="line">    conv2=nn.Conv2d(<span class="number">20</span>,<span class="number">64</span>,<span class="number">5</span>),</span><br><span class="line">    relu2=nn.ReLU())</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>Did you notice? Uniqueness of names is also checked automatically.</p>
<h2 id="Iterable-unpacking"><a href="#Iterable-unpacking" class="headerlink" title="Iterable unpacking"></a>Iterable unpacking</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># handy when amount of additional stored info may vary between experiments, but the same code can be used in all cases</span></span><br><span class="line">model_paramteres, optimizer_parameters, *other_params = load(checkpoint_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># picking two last values from a sequence</span></span><br><span class="line">*prev, next_to_last, last = values_history</span><br><span class="line"></span><br><span class="line"><span class="comment"># This also works with any iterables, so if you have a function that yields e.g. qualities,</span></span><br><span class="line"><span class="comment"># below is a simple way to take only last two values from a list</span></span><br><span class="line">*prev, next_to_last, last = iter_train(args)</span><br></pre></td></tr></table></figure>
<h2 id="Default-pickle-engine-provides-better-compression-for-arrays"><a href="#Default-pickle-engine-provides-better-compression-for-arrays" class="headerlink" title="Default pickle engine provides better compression for arrays"></a>Default pickle engine provides better compression for arrays</h2><p>Pickling is a mechanism to pass data between threads / processes, in particular used inside <code>multiprocessing</code> package. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="keyword">import</span> cPickle <span class="keyword">as</span> pickle</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">print</span> len(pickle.dumps(numpy.random.normal(size=[<span class="number">1000</span>, <span class="number">1000</span>])))</span><br><span class="line"><span class="comment"># result: 23691675</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line">len(pickle.dumps(numpy.random.normal(size=[<span class="number">1000</span>, <span class="number">1000</span>])))</span><br><span class="line"><span class="comment"># result: 8000162</span></span><br></pre></td></tr></table></figure>
<p>Three times less space. And it is <em>much</em> faster.<br>Actually similar compression (but not speed) is achievable with <code>protocol=2</code> parameter, but developers typically ignore this option (or simply are not aware of it). </p>
<p>Note: pickle is <a href="https://docs.python.org/3/library/pickle.html" target="_blank" rel="noopener">not safe</a> (and not quite transferrable), so never unpickle data received from an untrusted or unauthenticated source.</p>
<h2 id="Safer-comprehensions"><a href="#Safer-comprehensions" class="headerlink" title="Safer comprehensions"></a>Safer comprehensions</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">labels = &lt;initial_value&gt;</span><br><span class="line">predictions = [model.predict(data) <span class="keyword">for</span> data, labels <span class="keyword">in</span> dataset]</span><br><span class="line"></span><br><span class="line"><span class="comment"># labels are overwritten in Python 2</span></span><br><span class="line"><span class="comment"># labels are not affected by comprehension in Python 3</span></span><br></pre></td></tr></table></figure>
<h2 id="Super-simply-super"><a href="#Super-simply-super" class="headerlink" title="Super, simply super()"></a>Super, simply super()</h2><p>Python 2 <code>super(...)</code> was a frequent source of mistakes in code.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span><span class="params">(MySuperClass)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, **options)</span>:</span></span><br><span class="line">        super(MySubClass, self).__init__(name=<span class="string">'subclass'</span>, **options)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span><span class="params">(MySuperClass)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, **options)</span>:</span></span><br><span class="line">        super().__init__(name=<span class="string">'subclass'</span>, **options)</span><br></pre></td></tr></table></figure>
<p>More on <code>super</code> and method resolution order on <a href="https://stackoverflow.com/questions/576169/understanding-python-super-with-init-methods" target="_blank" rel="noopener">stackoverflow</a>.</p>
<h2 id="Better-IDE-suggestions-with-variable-annotations"><a href="#Better-IDE-suggestions-with-variable-annotations" class="headerlink" title="Better IDE suggestions with variable annotations"></a>Better IDE suggestions with variable annotations</h2><p>The most enjoyable thing about programming in languages like Java, C# and alike is that IDE can make very good suggestions,<br>because type of each identifier is known before executing a program.</p>
<p>In python this is hard to achieve, but annotations will help you</p>
<ul>
<li>write your expectations in a clear form</li>
<li>and get good suggestions from IDE</li>
</ul>
<p><img src="images/variable_annotations.png"><br><br>This is an example of PyCharm suggestions with variable annotations.<br>This works even in situations when functions you use are not annotated (e.g. due to backward compatibility).</p>
<h2 id="Multiple-unpacking"><a href="#Multiple-unpacking" class="headerlink" title="Multiple unpacking"></a>Multiple unpacking</h2><p>Here is how you merge two dicts now:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = dict(a=<span class="number">1</span>, b=<span class="number">2</span>)</span><br><span class="line">y = dict(b=<span class="number">3</span>, d=<span class="number">4</span>)</span><br><span class="line"><span class="comment"># Python 3.5+</span></span><br><span class="line">z = &#123;**x, **y&#125;</span><br><span class="line"><span class="comment"># z = &#123;'a': 1, 'b': 3, 'd': 4&#125;, note that value for `b` is taken from the latter dict.</span></span><br></pre></td></tr></table></figure></p>
<p>See <a href="https://stackoverflow.com/questions/38987/how-to-merge-two-dictionaries-in-a-single-expression" target="_blank" rel="noopener">this thread at StackOverflow</a> for a comparison with Python 2.</p>
<p>The same approach also works for lists, tuples, and sets (<code>a</code>, <code>b</code>, <code>c</code> are any iterables):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[*a, *b, *c] <span class="comment"># list, concatenating</span></span><br><span class="line">(*a, *b, *c) <span class="comment"># tuple, concatenating</span></span><br><span class="line">&#123;*a, *b, *c&#125; <span class="comment"># set, union</span></span><br></pre></td></tr></table></figure></p>
<p>Functions also <a href="https://docs.python.org/3/whatsnew/3.5.html#whatsnew-pep-448" target="_blank" rel="noopener">support multiple unpacking</a> for <code>*args</code> and <code>**kwargs</code>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3.5+</span></span><br><span class="line">do_something(**&#123;**default_settings, **custom_settings&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Also possible, this code also checks there is no intersection between keys of dictionaries</span></span><br><span class="line">do_something(**first_args, **second_args)</span><br></pre></td></tr></table></figure></p>
<h2 id="Future-proof-APIs-with-keyword-only-arguments"><a href="#Future-proof-APIs-with-keyword-only-arguments" class="headerlink" title="Future-proof APIs with keyword-only arguments"></a>Future-proof APIs with keyword-only arguments</h2><p>Let’s consider this snippet<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = sklearn.svm.SVC(<span class="number">2</span>, <span class="string">'poly'</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">0.5</span>)</span><br></pre></td></tr></table></figure></p>
<p>Obviously, an author of this code didn’t get the Python style of coding yet (most probably, just jumped from cpp or rust).<br>Unfortunately, this is not just question of taste, because changing the order of arguments (adding/deleting) in <code>SVC</code> will break this code. In particular, <code>sklearn</code> does some reordering/renaming from time to time of numerous algorithm parameters to provide consistent API. Each such refactoring may drive to broken code.</p>
<p>In Python 3, library authors may demand explicitly named parameters by using <code>*</code>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SVC</span><span class="params">(BaseSVC)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *, C=<span class="number">1.0</span>, kernel=<span class="string">'rbf'</span>, degree=<span class="number">3</span>, gamma=<span class="string">'auto'</span>, coef0=<span class="number">0.0</span>, ... )</span></span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>users have to specify names of parameters <code>sklearn.svm.SVC(C=2, kernel=&#39;poly&#39;, degree=2, gamma=4, coef0=0.5)</code> now</li>
<li>this mechanism provides a great combination of reliability and flexibility of APIs</li>
</ul>
<h2 id="Data-classes"><a href="#Data-classes" class="headerlink" title="Data classes"></a>Data classes</h2><p>Python 3.7 introduces data classes, a good replacement for <code>namedtuple</code> in most cases.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    name: str</span><br><span class="line">    age: int</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coder</span><span class="params">(Person)</span>:</span></span><br><span class="line">    preferred_language: str = <span class="string">'Python 3'</span></span><br></pre></td></tr></table></figure></p>
<p><code>dataclass</code> decorator takes the job of implementing routine methods for you (initialization, representation, comparison, and hashing when applicable).<br>Let’s name some features:</p>
<ul>
<li>data classes can be both mutable and immutable</li>
<li>default values for fields are supported</li>
<li>inheritance</li>
<li>data classes are still old good classes: you can define new methods and override existing</li>
<li>post-init processing (e.g. to verify consistency) </li>
</ul>
<p>Geir Arne Hjelle gives a good overview of dataclasses <a href="https://realpython.com/python-data-classes/" target="_blank" rel="noopener">in his post</a>.</p>
<h2 id="Customizing-access-to-module-attributes"><a href="#Customizing-access-to-module-attributes" class="headerlink" title="Customizing access to module attributes"></a>Customizing access to module attributes</h2><p>In Python you can control attribute access and hinting with <code>__getattr__</code> and <code>__dir__</code> for any object. Since python 3.7 you can do it for modules too.</p>
<p>A natural example is implementing a <code>random</code> submodule of tensor libraries, which is typically a shortcut to skip initialization and passing of RandomState objects. Here’s implementation for numpy:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nprandom.py</span></span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line">__random_state = numpy.random.RandomState()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> getattr(__random_state, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__dir__</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> dir(__random_state)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">seed</span><span class="params">(seed)</span>:</span></span><br><span class="line">    __random_state = numpy.random.RandomState(seed=seed)</span><br></pre></td></tr></table></figure></p>
<p>One can also mix this way functionalities of different objects/submodules. Compare with tricks in <a href="https://github.com/pytorch/pytorch/blob/3ce17bf8f6a2c4239085191ea60d6ee51cd620a5/torch/__init__.py#L253-L256" target="_blank" rel="noopener">pytorch</a> and <a href="https://github.com/cupy/cupy/blob/94592ecac8152d5f4a56a129325cc91d184480ad/cupy/random/distributions.py" target="_blank" rel="noopener">cupy</a>.</p>
<p>Additionally, now one can</p>
<ul>
<li>use it for <a href="https://snarky.ca/lazy-importing-in-python-3-7/" target="_blank" rel="noopener">lazy loading of submodules</a>. For example, <code>import tensorflow</code> takes <strong>~150MB</strong> of RAM is imports all submodules (and dependencies). </li>
<li>use this for <a href="https://www.python.org/dev/peps/pep-0562/" target="_blank" rel="noopener">deprecations in API</a></li>
<li>introduce runtime routing between submodules</li>
</ul>
<h2 id="Built-in-breakpoint"><a href="#Built-in-breakpoint" class="headerlink" title="Built-in breakpoint()"></a>Built-in breakpoint()</h2><p>Just write <code>breakpoint()</code> in the code to invoke debugger.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3.7+, not all IDEs support this at the moment</span></span><br><span class="line">foo()</span><br><span class="line">breakpoint()</span><br><span class="line">bar()</span><br></pre></td></tr></table></figure></p>
<p>For remote debugging you may want to try <a href="https://hackernoon.com/python-3-7s-new-builtin-breakpoint-a-quick-tour-4f1aebc444c" target="_blank" rel="noopener">combining breakpoint() with <code>web-pdb</code></a></p>
<h2 id="Minor-constants-in-math-module"><a href="#Minor-constants-in-math-module" class="headerlink" title="Minor: constants in math module"></a>Minor: constants in <code>math</code> module</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">math.inf <span class="comment"># Infinite float</span></span><br><span class="line">math.nan <span class="comment"># not a number</span></span><br><span class="line"></span><br><span class="line">max_quality = -math.inf  <span class="comment"># no more magic initial values!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> model <span class="keyword">in</span> trained_models:</span><br><span class="line">    max_quality = max(max_quality, compute_quality(model, data))</span><br></pre></td></tr></table></figure>
<h2 id="Minor-single-integer-type"><a href="#Minor-single-integer-type" class="headerlink" title="Minor: single integer type"></a>Minor: single integer type</h2><p>Python 2 provides two basic integer types, which are <code>int</code> (64-bit signed integer) and <code>long</code> for long arithmetics (quite confusing after C++).</p>
<p>Python 3 has a single type <code>int</code>, which incorporates long arithmetics.</p>
<p>Here is how you check that value is integer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isinstance(x, numbers.Integral) <span class="comment"># Python 2, the canonical way</span></span><br><span class="line">isinstance(x, (long, int))      <span class="comment"># Python 2</span></span><br><span class="line">isinstance(x, int)              <span class="comment"># Python 3, easier to remember</span></span><br></pre></td></tr></table></figure>
<p>Update: first check also works for <em>other integral types</em>, such as <code>numpy.int32</code>, <code>numpy.int64</code>, but others don’t. So they’re not equivalent.</p>
<h2 id="Other-stuff"><a href="#Other-stuff" class="headerlink" title="Other stuff"></a>Other stuff</h2><ul>
<li><code>Enum</code>s are theoretically useful, but<ul>
<li>string-typing is already widely adopted in the python data stack</li>
<li><code>Enum</code>s don’t seem to interplay with numpy and categorical from pandas</li>
</ul>
</li>
<li>coroutines also <em>sound</em> very promising for data pipelining (see <a href="http://www.dabeaz.com/coroutines/Coroutines.pdf" target="_blank" rel="noopener">slides</a> by David Beazley), but I don’t see their adoption in the wild.</li>
<li>Python 3 has <a href="https://www.python.org/dev/peps/pep-0384/" target="_blank" rel="noopener">stable ABI</a></li>
<li>Python 3 supports unicode identifies (so <code>ω = Δφ / Δt</code> is ok), but you’d <a href="https://stackoverflow.com/a/29855176/498892" target="_blank" rel="noopener">better use good old ASCII names</a></li>
<li>some libraries e.g. <a href="https://github.com/jupyterhub/jupyterhub" target="_blank" rel="noopener">jupyterhub</a> (jupyter in cloud), django and fresh ipython only support Python 3, so features that sound useless for you are useful for libraries you’ll probably want to use once.</li>
</ul>
<h3 id="Problems-for-code-migration-specific-for-data-science-and-how-to-resolve-those"><a href="#Problems-for-code-migration-specific-for-data-science-and-how-to-resolve-those" class="headerlink" title="Problems for code migration specific for data science (and how to resolve those)"></a>Problems for code migration specific for data science (and how to resolve those)</h3><ul>
<li><p>support for nested arguments <a href="https://www.python.org/dev/peps/pep-3113/" target="_blank" rel="noopener">was dropped</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map(<span class="keyword">lambda</span> x, (y, z): x, z, dict.items())</span><br></pre></td></tr></table></figure>
<p>However, it is still perfectly working with different comprehensions:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;x:z <span class="keyword">for</span> x, (y, z) <span class="keyword">in</span> d.items()&#125;</span><br></pre></td></tr></table></figure>
<p>In general, comprehensions are also better ‘translatable’ between Python 2 and 3.</p>
</li>
<li><p><code>map()</code>, <code>.keys()</code>, <code>.values()</code>, <code>.items()</code>, etc. return iterators, not lists. Main problems with iterators are:</p>
<ul>
<li>no trivial slicing</li>
<li>can’t be iterated twice</li>
</ul>
<p>Almost all of the problems are resolved by converting result to list.</p>
</li>
<li><p>see <a href="https://eev.ee/blog/2016/07/31/python-faq-how-do-i-port-to-python-3/" target="_blank" rel="noopener">Python FAQ: How do I port to Python 3?</a> when in trouble</p>
</li>
</ul>
<h3 id="Main-problems-for-teaching-machine-learning-and-data-science-with-python"><a href="#Main-problems-for-teaching-machine-learning-and-data-science-with-python" class="headerlink" title="Main problems for teaching machine learning and data science with python"></a>Main problems for teaching machine learning and data science with python</h3><p>Course authors should spend time in the first lectures to explain what is an iterator,<br>why it can’t be sliced / concatenated / multiplied / iterated twice like a string (and how to deal with it).</p>
<p>I think most course authors would be happy to avoid these details, but now it is hardly possible.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Python 2 and Python 3 have co-existed for almost 10 years, but we <em>should</em> move to Python 3.</p>
<p>Research and production code should become a bit shorter, more readable, and significantly safer after moving to Python 3-only codebase.</p>
<p>Right now most libraries support both Python versions.<br>And I can’t wait for the bright moment when packages drop support for Python 2 and enjoy new language features.</p>
<p>Following migrations are promised to be smoother: <a href="https://snarky.ca/why-python-3-exists/" target="_blank" rel="noopener">“we will never do this kind of backwards-incompatible change again”</a></p>
<h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><ul>
<li><a href="http://sebastianraschka.com/Articles/2014_python_2_3_key_diff.html" target="_blank" rel="noopener">Key differences between Python 2.7 and Python 3.x</a></li>
<li><a href="https://eev.ee/blog/2016/07/31/python-faq-how-do-i-port-to-python-3/" target="_blank" rel="noopener">Python FAQ: How do I port to Python 3?</a></li>
<li><a href="http://www.asmeurer.com/python3-presentation/slides.html" target="_blank" rel="noopener">10 awesome features of Python that you can’t use because you refuse to upgrade to Python 3</a></li>
<li><a href="http://pyvideo.org/pycon-us-2013/python-33-trust-me-its-better-than-27.html" target="_blank" rel="noopener">Trust me, python 3.3 is better than 2.7 (video)</a></li>
<li><a href="http://python-3-for-scientists.readthedocs.io/en/latest/" target="_blank" rel="noopener">Python 3 for scientists</a></li>
</ul>
<h3 id="License"><a href="#License" class="headerlink" title="License"></a>License</h3><p>This text was published by <a href="https://arogozhnikov.github.io/about/" target="_blank" rel="noopener">Alex Rogozhnikov</a> and <a href="https://github.com/arogozhnikov/python3_with_pleasure/graphs/contributors" target="_blank" rel="noopener">contributors</a> under <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0 License</a> (excluding images).</p>
<h1 id="中文版本"><a href="#中文版本" class="headerlink" title="中文版本"></a>中文版本</h1><h2 id="为数据科学家提供的关于Python-3特性的简介"><a href="#为数据科学家提供的关于Python-3特性的简介" class="headerlink" title="为数据科学家提供的关于Python 3特性的简介"></a>为数据科学家提供的关于Python 3特性的简介</h2><blockquote>
<p>Python became a mainstream language for machine learning and other scientific fields that heavily operate with data;<br>it boasts various deep learning frameworks and well-established set of tools for data processing and visualization.</p>
</blockquote>
<p>Python 已成为机器学习以及其他紧密结合数据的科学领域的主流语言；它提供了各种深度学习的框架以及一系列完善的数据处理和可视化工具。</p>
<blockquote>
<p>However, Python ecosystem co-exists in Python 2 and Python 3, and Python 2 is still used among data scientists.<br>By the end of 2019 the scientific stack will <a href="http://www.python3statement.org" target="_blank" rel="noopener">stop supporting Python2</a>.<br>As for numpy, after 2018 any new feature releases will only support <a href="https://github.com/numpy/numpy/blob/master/doc/neps/dropping-python2.7-proposal.rst" target="_blank" rel="noopener">Python3</a>.</p>
</blockquote>
<p>然而，Python 的生态圈中 Python 2 和 Python 3 是共存状态，并且数据科学家之中是依然有使用 Python 2 的。2019年年底（Python的）科学组件将会<a href="http://www.python3statement.org" target="_blank" rel="noopener">停止支持 Python 2 </a>。 至于numpy，2018年之后任何推出的新特性将会只支持<a href="https://github.com/numpy/numpy/blob/master/doc/neps/dropping-python2.7-proposal.rst" target="_blank" rel="noopener">Python 3</a> 。</p>
<blockquote>
<p>To make the transition less frustrating, I’ve collected a bunch of Python 3 features that you may find useful.</p>
</blockquote>
<p>为了让这一过渡更轻松一点，我整理了一些 Python 3 你可能觉得有用的特性。</p>
<p><img src="https://uploads.toptal.io/blog/image/92216/toptal-blog-image-1457618659472-be2f380fe3aad41333427ecd5a1ec5c5.jpg" width="400"></p>
<p>图片来源 <a href="https://www.toptal.com/python/python-3-is-it-worth-the-switch" target="_blank" rel="noopener">Dario Bertini post (toptal)</a></p>
<h2 id="pathlib提供了更好的路径处理"><a href="#pathlib提供了更好的路径处理" class="headerlink" title="pathlib提供了更好的路径处理"></a><code>pathlib</code>提供了更好的路径处理</h2><blockquote>
<p><code>pathlib</code> is a default module in python3, that helps you to avoid tons of <code>os.path.join</code>s:</p>
</blockquote>
<p><code>pathlib</code> 是Python 3 一个默认的组件，有助于避免大量使用<code>os.path.join</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">dataset = <span class="string">'wiki_images'</span></span><br><span class="line">datasets_root = Path(<span class="string">'/path/to/datasets/'</span>)</span><br><span class="line"></span><br><span class="line">train_path = datasets_root / dataset / <span class="string">'train'</span></span><br><span class="line">test_path = datasets_root / dataset / <span class="string">'test'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> image_path <span class="keyword">in</span> train_path.iterdir():</span><br><span class="line">    <span class="keyword">with</span> image_path.open() <span class="keyword">as</span> f: <span class="comment"># note, open is a method of Path object</span></span><br><span class="line">        <span class="comment"># do something with an image</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Previously it was always tempting to use string concatenation (concise, but obviously bad),<br>now with <code>pathlib</code> the code is safe, concise, and readable.</p>
</blockquote>
<p>以前，人们倾向于使用字符串连接（虽然简洁，但明显不好）；现在，代码中用<code>pathlib</code>是安全的，简洁的，并且更有可读性。</p>
<blockquote>
<p>Also <code>pathlib.Path</code> has a bunch of methods and properties, that every python novice previously had to google:</p>
</blockquote>
<p>此外，<code>pathlib.Path</code>有大量的方法和属性，每一位 Python 早期的初学者不得不谷歌了解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p.exists()</span><br><span class="line">p.is_dir()</span><br><span class="line">p.parts</span><br><span class="line">p.with_name(<span class="string">'sibling.png'</span>) <span class="comment"># only change the name, but keep the folder</span></span><br><span class="line">p.with_suffix(<span class="string">'.jpg'</span>) <span class="comment"># only change the extension, but keep the folder and the name</span></span><br><span class="line">p.chmod(mode)</span><br><span class="line">p.rmdir()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>pathlib</code> should save you lots of time,<br>please see <a href="https://docs.python.org/3/library/pathlib.html" target="_blank" rel="noopener">docs</a> and <a href="https://pymotw.com/3/pathlib/" target="_blank" rel="noopener">reference</a> for more.</p>
</blockquote>
<p><code>pathlib</code> 应当会节省大量时间，请参看<a href="https://docs.python.org/3/library/pathlib.html" target="_blank" rel="noopener">文档</a>以及<a href="https://pymotw.com/3/pathlib/" target="_blank" rel="noopener">指南</a>了解更多。</p>
<h2 id="类型提示现在已是这语言的一部分"><a href="#类型提示现在已是这语言的一部分" class="headerlink" title="类型提示现在已是这语言的一部分"></a>类型提示现在已是这语言的一部分</h2><blockquote>
<p>Example of type hinting in pycharm: <br></p>
</blockquote>
<p>pycharm环境类型提示的例子：</p>
<p><img src="images/pycharm-type-hinting.png"></p>
<blockquote>
<p>Python is not just a language for small scripts anymore,<br>data pipelines these days include numerous steps each involving different frameworks (and sometimes very different logic).</p>
</blockquote>
<p>Python 不再是一种小型的脚本语言，数据管道现如今包含数个级别，而每一级又涉及到不同的框架（甚至有时是千差万别的逻辑）。</p>
<blockquote>
<p>Type hinting was introduced to help with growing complexity of programs, so machines could help with code verification.<br>Previously different modules used custom ways to point <a href="https://www.jetbrains.com/help/pycharm/type-hinting-in-pycharm.html#legacy" target="_blank" rel="noopener">types in docstrings</a><br>(Hint: pycharm can convert old docstrings to fresh type hinting).</p>
</blockquote>
<p>类型提示的引入是为了在程序的持续增加的复杂性方面提供帮助，这样机器可以辅助代码验证。以前不同的模块使用自定义的方式指定<a href="https://www.jetbrains.com/help/pycharm/type-hinting-in-pycharm.html#legacy" target="_blank" rel="noopener">文档字符中的类型</a>(提示：pycharm可以将旧的字符串转换成新的类型提示)。</p>
<blockquote>
<p>As a simple example, the following code may work with different types of data (that’s what we like about python data stack).</p>
</blockquote>
<p>作为一个简单的例子，下面的代码可以适用于数据的不同类型（这也是关于数据栈我们喜欢的一点）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat_each_entry</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="string">""" Each entry in the data is doubled</span></span><br><span class="line"><span class="string">    &lt;blah blah nobody reads the documentation till the end&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    index = numpy.repeat(numpy.arange(len(data)), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> data[index]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>This code e.g. works for <code>numpy.array</code> (incl. multidimensional ones), <code>astropy.Table</code> and <code>astropy.Column</code>, <code>bcolz</code>, <code>cupy</code>, <code>mxnet.ndarray</code> and others.</p>
</blockquote>
<p>这段代码可适用于例如 <code>numpy.array</code> (包括多维数组)， <code>astropy.Table</code> 以及 <code>astropy.Column</code>， <code>bcolz</code>， <code>cupy</code>, <code>mxnet.ndarray</code> 和其他的组件。</p>
<blockquote>
<p>This code will work for <code>pandas.Series</code>, but in the wrong way:</p>
</blockquote>
<p>这段代码虽然也适用于<code>pandas.Series</code>，但是是错误的使用方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repeat_each_entry(pandas.Series(data=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], index=[<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])) <span class="comment"># returns Series with Nones inside</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>This was two lines of code. Imagine how unpredictable behavior of a complex system, because just one function may misbehave.<br>Stating explicitly which types a method expects is very helpful in large systems, this will warn you if a function was passed unexpected arguments.</p>
</blockquote>
<p>这曾经是两行代码。想象一下一个复杂系统不可预知的行为，仅仅是因为一个功能可能会失败。在大型的系统中，明确地指出方法期望的类型是非常有帮助的。如果一个方法通过了意外参数，则会给出警告。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat_each_entry</span><span class="params">(data: Union[numpy.ndarray, bcolz.carray])</span>:</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>If you have a significant codebase, hinting tools like <a href="http://mypy.readthedocs.io" target="_blank" rel="noopener">MyPy</a> are likely to become part of your continuous integration pipeline.A webinar <a href="https://www.youtube.com/watch?v=JqBCFfiE11g" target="_blank" rel="noopener">“Putting Type Hints to Work”</a> by Daniel Pyrathon is good for a brief introduction.</p>
</blockquote>
<p>如果你有一个重要的代码仓库，比如<a href="http://mypy.readthedocs.io" target="_blank" rel="noopener">MyPy</a>的提示工具有可能成为你持续集成管道的一部分。Daniel Pyrathon主持的<a href="https://www.youtube.com/watch?v=JqBCFfiE11g" target="_blank" rel="noopener">“Putting Type Hints to Work”</a>研讨会，给出了一个很好的简介。</p>
<blockquote>
<p>Sidenote: unfortunately, hinting is not yet powerful enough to provide fine-grained typing for ndarrays/tensors, but <a href="https://github.com/numpy/numpy/issues/7370" target="_blank" rel="noopener">maybe we’ll have it once</a>, and this will be a great feature for DS.</p>
</blockquote>
<p>边注：不幸的是，提示信息还不够强大为多维数组/张量提供精细的提示。但是<a href="https://github.com/numpy/numpy/issues/7370" target="_blank" rel="noopener">也许我们会有</a>，并且这将是DS的一个强大功能。</p>
<h2 id="类型提示-→-在运行时检查类型"><a href="#类型提示-→-在运行时检查类型" class="headerlink" title="类型提示 → 在运行时检查类型"></a>类型提示 → 在运行时检查类型</h2><blockquote>
<p>By default, function annotations do not influence how your code is working, but merely help you to point code intentions.</p>
</blockquote>
<p>默认情况下，方法声明不会影响你运行中的代码，而只是帮助你指出代码的意图。</p>
<blockquote>
<p>However, you can enforce type checking in runtime with tools like … <a href="https://github.com/RussBaz/enforce" target="_blank" rel="noopener">enforce</a>,<br>this can help you in debugging (there are many cases when type hinting is not working).</p>
</blockquote>
<p>然而，你可以利用工具，比如<a href="https://github.com/RussBaz/enforce" target="_blank" rel="noopener">enforce</a>，在代码运行时执行类型检查，这对你在debug代码时是很有帮助的（类型提示不起作用的情况也很多）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@enforce.runtime_validation</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(text: str)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    print(text)</span><br><span class="line"></span><br><span class="line">foo(<span class="string">'Hi'</span>) <span class="comment"># ok</span></span><br><span class="line">foo(<span class="number">5</span>)    <span class="comment"># fails</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@enforce.runtime_validation</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">any2</span><span class="params">(x: List[bool])</span> -&gt; bool:</span></span><br><span class="line">    <span class="keyword">return</span> any(x)</span><br><span class="line"></span><br><span class="line">any ([<span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">False</span>]) <span class="comment"># True</span></span><br><span class="line">any2([<span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">False</span>]) <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">any ([<span class="string">'False'</span>]) <span class="comment"># True</span></span><br><span class="line">any2([<span class="string">'False'</span>]) <span class="comment"># fails</span></span><br><span class="line"></span><br><span class="line">any ([<span class="literal">False</span>, <span class="literal">None</span>, <span class="string">""</span>, <span class="number">0</span>]) <span class="comment"># False</span></span><br><span class="line">any2([<span class="literal">False</span>, <span class="literal">None</span>, <span class="string">""</span>, <span class="number">0</span>]) <span class="comment"># fails</span></span><br></pre></td></tr></table></figure>
<h2 id="方法声明的其他用途"><a href="#方法声明的其他用途" class="headerlink" title="方法声明的其他用途"></a>方法声明的其他用途</h2><blockquote>
<p>As mentioned before, annotations do not influence code execution, but rather provide some meta-information,<br>and you can use it as you wish.</p>
</blockquote>
<p>正如之前提到的，声明不会影响代码执行，而只是提供一些元信息，此外你也可以随意使用。</p>
<blockquote>
<p>For instance, measurement units are a common pain in scientific areas, <code>astropy</code> package <a href="http://docs.astropy.org/en/stable/units/quantity.html#functions-that-accept-quantities" target="_blank" rel="noopener">provides a simple decorator</a> to control units of input quantities and convert output to required units.</p>
</blockquote>
<p>比如，测量单位是科学领域常见的痛点，<code>astropy</code>包<a href="http://docs.astropy.org/en/stable/units/quantity.html#functions-that-accept-quantities" target="_blank" rel="noopener">提供了一个简单的装饰器</a>用来控制输入数量的单位及转换输出部分所需的单位。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line"><span class="keyword">from</span> astropy <span class="keyword">import</span> units <span class="keyword">as</span> u</span><br><span class="line"><span class="meta">@u.quantity_input()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">frequency</span><span class="params">(speed: u.meter / u.s, wavelength: u.m)</span> -&gt; u.terahertz:</span></span><br><span class="line">    <span class="keyword">return</span> speed / wavelength</span><br><span class="line"></span><br><span class="line">frequency(speed=<span class="number">300</span>_000 * u.km / u.s, wavelength=<span class="number">555</span> * u.nm)</span><br><span class="line"><span class="comment"># output: 540.5405405405404 THz, frequency of green visible light</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>If you’re processing tabular scientific data in python (not necessarily astronomical), you should give <code>astropy</code> a shot.</p>
</blockquote>
<p>如果你正在用Python处理表格式的科学数据（没必要是天文数字），那么你应该试试<code>astropy</code>。</p>
<blockquote>
<p>You can also define your application-specific decorators to perform control / conversion of inputs and output in the same manner.</p>
</blockquote>
<p>你也可以自定义专用的装饰器，以相同的方式执行输入和输出的控制/转换。</p>
<h2 id="矩阵乘号"><a href="#矩阵乘号" class="headerlink" title="矩阵乘号 @"></a>矩阵乘号 @</h2><blockquote>
<p>Let’s implement one of the simplest ML models &mdash; a linear regression with l2 regularization (a.k.a. ridge regression):</p>
</blockquote>
<p>让我们来实现一个最简单的 ML(机器学习) 模型 &mdash; 具有 l2 正则化的线性回归（又名岭回归）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># l2-regularized linear regression: || AX - b ||^2 + alpha * ||x||^2 -&gt; min</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">X = np.linalg.inv(np.dot(A.T, A) + alpha * np.eye(A.shape[<span class="number">1</span>])).dot(A.T.dot(b))</span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">X = np.linalg.inv(A.T @ A + alpha * np.eye(A.shape[<span class="number">1</span>])) @ (A.T @ b)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The code with <code>@</code> becomes more readable and more translatable between deep learning frameworks: same code <code>X @ W + b[None, :]</code> for a single layer of perceptron works in <code>numpy</code>, <code>cupy</code>, <code>pytorch</code>, <code>tensorflow</code> (and other frameworks that operate with tensors).</p>
</blockquote>
<p>使用<code>@</code>的代码在深度学习框架之间变得更有可读性和可转换性：对于单层感知器，相同的代码<code>X @ W + b[None, :]</code> 可运行与<code>numpy</code>、 <code>cupy</code>、 <code>pytorch</code>、 <code>tensorflow</code>（以及其他基于张量运行的框架）。</p>
<h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符 **"></a>通配符 <code>**</code></h2><blockquote>
<p>Recursive folder globbing is not easy in Python 2, even though the <a href="https://github.com/miracle2k/python-glob2" target="_blank" rel="noopener">glob2</a> custom module exists that overcomes this. A recursive flag is supported since Python 3.5:</p>
</blockquote>
<p>即使<a href="https://github.com/miracle2k/python-glob2" target="_blank" rel="noopener">glob2</a>的自定义模块克服了这一点，但是在Python 2中递归的文件夹通配依旧不容易。自Python3.5以来便支持了递归标志：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">found_images = \</span><br><span class="line">    glob.glob(<span class="string">'/path/*.jpg'</span>) \</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*.jpg'</span>) \</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*/*.jpg'</span>) \</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*/*/*.jpg'</span>) \</span><br><span class="line">  + glob.glob(<span class="string">'/path/*/*/*/*/*.jpg'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">found_images = glob.glob(<span class="string">'/path/**/*.jpg'</span>, recursive=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>A better option is to use <code>pathlib</code> in python3 (minus one import!):</p>
</blockquote>
<p>一个更好的选项就是在Python 3中使用<code>pathlib</code>(减少了一个导入！)：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">found_images = pathlib.Path(<span class="string">'/path/'</span>).glob(<span class="string">'**/*.jpg'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="Print-现在成了一个方法"><a href="#Print-现在成了一个方法" class="headerlink" title="Print 现在成了一个方法"></a>Print 现在成了一个方法</h2><blockquote>
<p>Yes, code now has these annoying parentheses, but there are some advantages:</p>
</blockquote>
<p>是的，代码现在有了这些烦人的括号，但也是有一些好处的：</p>
<blockquote>
<ul>
<li>simple syntax for using file descriptor:</li>
<li>使用文件描述符的简单语法:</li>
</ul>
</blockquote>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> &gt;&gt;sys.stderr, <span class="string">"critical error"</span>      <span class="comment"># Python 2</span></span><br><span class="line">print(<span class="string">"critical error"</span>, file=sys.stderr)  <span class="comment"># Python 3</span></span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<ul>
<li>printing tab-aligned tables without <code>str.join</code>:</li>
<li>不使用<code>str.join</code>打印制表符对齐表：</li>
</ul>
</blockquote>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">print(*array, sep=<span class="string">'\t'</span>)</span><br><span class="line">print(batch, epoch, loss, accuracy, time, sep=<span class="string">'\t'</span>)</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<ul>
<li>hacky suppressing / redirection of printing output:</li>
<li>结束/重定向打印输出：  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">_print = <span class="keyword">print</span> <span class="comment"># store the original print function</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print</span><span class="params">(*args, **kargs)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># do something useful, e.g. store output to some file</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<pre><code>In jupyter it is desirable to log each output to a separate file (to track what&#39;s happening after you got disconnected), so you can override `print` now.

在jupyter中，最好将每个输出记录到一个单独的文件中（以便跟踪断开连接后发生的情况），以便你现在可以重写 `print` 。

Below you can see a context manager that temporarily overrides behavior of print:

下面你可以看到暂时覆盖打印行为的上下文管理器：
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replace_print</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> builtins</span><br><span class="line">    _print = <span class="keyword">print</span> <span class="comment"># saving old print function</span></span><br><span class="line">    <span class="comment"># or use some other function here</span></span><br><span class="line">    builtins.<span class="keyword">print</span> = <span class="keyword">lambda</span> *args, **kwargs: _print(<span class="string">'new printing'</span>, *args, **kwargs)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    builtins.<span class="keyword">print</span> = _print</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> replace_print():</span><br><span class="line">    &lt;code here will invoke other <span class="keyword">print</span> function&gt;</span><br></pre></td></tr></table></figure>

It is *not* a recommended approach, but a small dirty hack that is now possible.

这*并不是*推荐的方法，现在却可能是一次小小的黑客攻击。
</code></pre><blockquote>
<ul>
<li><code>print</code> can participate in list comprehensions and other language constructs</li>
<li><code>print</code> 可以参与列表推导式和其他语言结构:</li>
</ul>
</blockquote>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">result = process(x) <span class="keyword">if</span> is_valid(x) <span class="keyword">else</span> print(<span class="string">'invalid item: '</span>, x)</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="数字中的下划线-（千位分隔符）"><a href="#数字中的下划线-（千位分隔符）" class="headerlink" title="数字中的下划线 （千位分隔符）"></a>数字中的下划线 （千位分隔符）</h2><blockquote>
<p><a href="https://www.python.org/dev/peps/pep-0515/" title="PEP-515" target="_blank" rel="noopener">PEP-515</a> introduced underscores in Numeric Literals.<br>In Python3, underscores can be used to group digits visually in integral, floating-point, and complex number literals.</p>
</blockquote>
<p><a href="https://www.python.org/dev/peps/pep-0515/" title="PEP-515" target="_blank" rel="noopener">PEP-515</a>在数字中引入了下划线。在Python 3 中，下划线可以用于在整数，浮点数，以及一些复杂的数字中以可视的方式对数字分组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grouping decimal numbers by thousands</span></span><br><span class="line">one_million = <span class="number">1</span>_000_000</span><br><span class="line"></span><br><span class="line"><span class="comment"># grouping hexadecimal addresses by words</span></span><br><span class="line">addr = <span class="number">0xCAFE</span>_F00D</span><br><span class="line"></span><br><span class="line"><span class="comment"># grouping bits into nibbles in a binary literal</span></span><br><span class="line">flags = <span class="number">0</span>b_0011_1111_0100_1110</span><br><span class="line"></span><br><span class="line"><span class="comment"># same, for string conversions</span></span><br><span class="line">flags = int(<span class="string">'0b_1111_0000'</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h2 id="用于简单可靠格式化的-f-strings"><a href="#用于简单可靠格式化的-f-strings" class="headerlink" title="用于简单可靠格式化的 f-strings"></a>用于简单可靠格式化的 f-strings</h2><blockquote>
<p>The default formatting system provides a flexibility that is not required in data experiments.<br>The resulting code is either too verbose or too fragile towards any changes.</p>
</blockquote>
<p>默认的格式化系统提供了数据实验中不必要的灵活性。由此产生的代码对于任何更改都显得过于冗长或者脆弱。</p>
<blockquote>
<p>Quite typically data scientists outputs some logging information iteratively in a fixed format.<br>It is common to have a code like:</p>
</blockquote>
<p>通常数据科学家会以固定的格式反复输出一些记录信息。如下代码就是常见的一段：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">print(<span class="string">'&#123;batch:3&#125; &#123;epoch:3&#125; / &#123;total_epochs:3&#125;  accuracy: &#123;acc_mean:0.4f&#125;±&#123;acc_std:0.4f&#125; time: &#123;avg_time:3.2f&#125;'</span>.format(</span><br><span class="line">    batch=batch, epoch=epoch, total_epochs=total_epochs,</span><br><span class="line">    acc_mean=numpy.mean(accuracies), acc_std=numpy.std(accuracies),</span><br><span class="line">    avg_time=time / len(data_batch)</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2 (too error-prone during fast modifications, please avoid):</span></span><br><span class="line">print(<span class="string">'&#123;:3&#125; &#123;:3&#125; / &#123;:3&#125;  accuracy: &#123;:0.4f&#125;±&#123;:0.4f&#125; time: &#123;:3.2f&#125;'</span>.format(</span><br><span class="line">    batch, epoch, total_epochs, numpy.mean(accuracies), numpy.std(accuracies),</span><br><span class="line">    time / len(data_batch)</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
<p>简单输出:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">120  12 / 300  accuracy: 0.8180±0.4649 time: 56.60</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>f-strings</strong> aka formatted string literals were introduced in Python 3.6:</p>
</blockquote>
<p><strong>f-string</strong> 又名格式化的字符串，在Python 3.6 中引入：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3.6+</span></span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;batch:<span class="number">3</span>&#125;</span> <span class="subst">&#123;epoch:<span class="number">3</span>&#125;</span> / <span class="subst">&#123;total_epochs:<span class="number">3</span>&#125;</span>  accuracy: <span class="subst">&#123;numpy.mean(accuracies):<span class="number">0.4</span>f&#125;</span>±<span class="subst">&#123;numpy.std(accuracies):<span class="number">0.4</span>f&#125;</span> time: <span class="subst">&#123;time / len(data_batch):<span class="number">3.2</span>f&#125;</span>'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="“真正的除法”与“整数除法”之间的明显区别"><a href="#“真正的除法”与“整数除法”之间的明显区别" class="headerlink" title="“真正的除法”与“整数除法”之间的明显区别"></a>“真正的除法”与“整数除法”之间的明显区别</h2><blockquote>
<p>For data science this is definitely a handy change.</p>
</blockquote>
<p>对于数据科学来说，这绝对是一个便利的改变。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = pandas.read_csv(<span class="string">'timing.csv'</span>)</span><br><span class="line">velocity = data[<span class="string">'distance'</span>] / data[<span class="string">'time'</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Results in Python 2 depend on whether ‘time’ and ‘distance’ (e.g. measured in meters and seconds) are stored as integers.<br>In Python 3, the result is correct in both cases, because the result of division is float.</p>
</blockquote>
<p>Python 2 中的计算结果取决于“时间”和“距离”（例如，分别以米和秒计量）是否存储为整数，而在Python 3 中，结果在两种情况下都是正确的，因为除法的计算结果是浮点型了。</p>
<blockquote>
<p>Another case is integer division, which is now an explicit operation:</p>
</blockquote>
<p>另一种情况是整数除法，它现在是一种精确的运算了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n_gifts = money // gift_price  <span class="comment"># correct for int and float arguments</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note, that this applies both to built-in types and to custom types provided by data packages (e.g. <code>numpy</code> or <code>pandas</code>).</p>
</blockquote>
<p>注意，这都适用于内置类型及数据包提供的自定义类型（如<code>numpy</code> 或者 <code>pandas</code>）。</p>
<h2 id="严谨的排序"><a href="#严谨的排序" class="headerlink" title="严谨的排序"></a>严谨的排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># All these comparisons are illegal in Python 3</span></span><br><span class="line"><span class="number">3</span> &lt; <span class="string">'3'</span></span><br><span class="line"><span class="number">2</span> &lt; <span class="literal">None</span></span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>) &lt; (<span class="number">3</span>, <span class="literal">None</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>) &lt; [<span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># False in both Python 2 and Python 3</span></span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>) == [<span class="number">4</span>, <span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>prevents from occasional sorting of instances of different types</li>
<li><p>防止偶尔对不同类型的实例进行排序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sorted([<span class="number">2</span>, <span class="string">'1'</span>, <span class="number">3</span>])  <span class="comment"># invalid for Python 3, in Python 2 returns [2, 3, '1']</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>helps to spot some problems that arise when processing raw data</p>
</li>
<li>有助于发现在处理原始数据时的一些问题</li>
</ul>
<p>Sidenote: proper check for None is (in both Python versions)</p>
</blockquote>
<p>边注：合理检查None的情况（Python两个版本中都有）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> a <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> a: <span class="comment"># WRONG check for None</span></span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<h2 id="用于NLP的Unicode"><a href="#用于NLP的Unicode" class="headerlink" title="用于NLP的Unicode"></a>用于NLP的Unicode</h2><p><em>译者注：NLP，自然语言处理 (Natural Language Processing) </em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'您好'</span></span><br><span class="line">print(len(s))</span><br><span class="line">print(s[:<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<ul>
<li>Python 2: <code>6\n��</code></li>
<li>Python 3: <code>2\n您好</code>.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = u&apos;со&apos;</span><br><span class="line">x += &apos;co&apos; # ok</span><br><span class="line">x += &apos;со&apos; # fail</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Python 2 fails, Python 3 works as expected (because I’ve used russian letters in strings).</p>
</blockquote>
<p>Python 2 失败了，Python 3 如预期运行（因为我在字符串中使用了俄语的文字）。</p>
<blockquote>
<p>In Python 3 <code>str</code>s are unicode strings, and it is more convenient for NLP processing of non-english texts.</p>
</blockquote>
<p>在Python 3 中，<code>str</code>是unicode字符串，对于非英文文本的NLP处理更为方便。</p>
<blockquote>
<p>There are other funny things, for instance:</p>
</blockquote>
<p>这还有一些其他有趣的事情，比如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'a'</span> &lt; type &lt; <span class="string">u'a'</span>  <span class="comment"># Python 2: True</span></span><br><span class="line"><span class="string">'a'</span> &lt; <span class="string">u'a'</span>         <span class="comment"># Python 2: False</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">Counter(<span class="string">'Möbelstück'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Python 2: <code>Counter({&#39;\xc3&#39;: 2, &#39;b&#39;: 1, &#39;e&#39;: 1, &#39;c&#39;: 1, &#39;k&#39;: 1, &#39;M&#39;: 1, &#39;l&#39;: 1, &#39;s&#39;: 1, &#39;t&#39;: 1, &#39;\xb6&#39;: 1, &#39;\xbc&#39;: 1})</code></li>
<li>Python 3: <code>Counter({&#39;M&#39;: 1, &#39;ö&#39;: 1, &#39;b&#39;: 1, &#39;e&#39;: 1, &#39;l&#39;: 1, &#39;s&#39;: 1, &#39;t&#39;: 1, &#39;ü&#39;: 1, &#39;c&#39;: 1, &#39;k&#39;: 1})</code></li>
</ul>
<blockquote>
<p>You can handle all of this in Python 2 properly, but Python 3 is more friendly.</p>
</blockquote>
<p>虽然你可以用Python 2正确地处理所有这些情况，但Python 3显得更加友好。</p>
<h2 id="保留字典和-kwargs的顺序"><a href="#保留字典和-kwargs的顺序" class="headerlink" title="保留字典和** kwargs的顺序"></a>保留字典和** kwargs的顺序</h2><blockquote>
<p>In CPython 3.6+ dicts behave like <code>OrderedDict</code> by default (and <a href="https://stackoverflow.com/questions/39980323/are-dictionaries-ordered-in-python-3-6" target="_blank" rel="noopener">this is guaranteed in Python 3.7+</a>).<br>This preserves order during dict comprehensions (and other operations, e.g. during json serialization/deserialization)</p>
</blockquote>
<p>在CPython 3.6+中，字典的默认行为与<code>OrderedDict</code>类似（并且<a href="(https://stackoverflow.com/questions/39980323/are-dictionaries-ordered-in-python-3-6">这在Python 3.7+ 中也得到了保证</a>)）。这在字典释义时提供了顺序（以及其他操作执行时，比如json序列化/反序列化）。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">x = &#123;str(i):i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)&#125;</span><br><span class="line">json.loads(json.dumps(x))</span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line">&#123;<span class="string">u'1'</span>: <span class="number">1</span>, <span class="string">u'0'</span>: <span class="number">0</span>, <span class="string">u'3'</span>: <span class="number">3</span>, <span class="string">u'2'</span>: <span class="number">2</span>, <span class="string">u'4'</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">&#123;<span class="string">'0'</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">2</span>, <span class="string">'3'</span>: <span class="number">3</span>, <span class="string">'4'</span>: <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Same applies to <code>**kwargs</code> (in Python 3.6+), they’re kept in the same order as they appear in parameters.<br>Order is crucial when it comes to data pipelines, previously we had to write it in a cumbersome manner:</p>
</blockquote>
<p>同样适用于<code>** kwargs</code>（Python 3.6+），它们保持与它们在参数中出现的顺序相同。在数据管道方面，顺序至关重要，以前我们必须以繁琐的方式来编写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from torch import nn</span><br><span class="line"></span><br><span class="line"># Python 2</span><br><span class="line">model = nn.Sequential(OrderedDict([</span><br><span class="line">          (&apos;conv1&apos;, nn.Conv2d(1,20,5)),</span><br><span class="line">          (&apos;relu1&apos;, nn.ReLU()),</span><br><span class="line">          (&apos;conv2&apos;, nn.Conv2d(20,64,5)),</span><br><span class="line">          (&apos;relu2&apos;, nn.ReLU())</span><br><span class="line">        ]))</span><br><span class="line"></span><br><span class="line"># Python 3.6+, how it *can* be done, not supported right now in pytorch</span><br><span class="line">model = nn.Sequential(</span><br><span class="line">    conv1=nn.Conv2d(1,20,5),</span><br><span class="line">    relu1=nn.ReLU(),</span><br><span class="line">    conv2=nn.Conv2d(20,64,5),</span><br><span class="line">    relu2=nn.ReLU())</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Did you notice? Uniqueness of names is also checked automatically.</p>
</blockquote>
<p>你注意到了吗？命名的唯一性也会自动检查。</p>
<h2 id="可迭代对象的（Iterable）解压"><a href="#可迭代对象的（Iterable）解压" class="headerlink" title="可迭代对象的（Iterable）解压"></a>可迭代对象的（Iterable）解压</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># handy when amount of additional stored info may vary between experiments, but the same code can be used in all cases</span></span><br><span class="line">model_paramteres, optimizer_parameters, *other_params = load(checkpoint_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># picking two last values from a sequence</span></span><br><span class="line">*prev, next_to_last, last = values_history</span><br><span class="line"></span><br><span class="line"><span class="comment"># This also works with any iterables, so if you have a function that yields e.g. qualities,</span></span><br><span class="line"><span class="comment"># below is a simple way to take only last two values from a list</span></span><br><span class="line">*prev, next_to_last, last = iter_train(args)</span><br></pre></td></tr></table></figure>
<h2 id="默认的pickle引擎为数组提供更好的压缩"><a href="#默认的pickle引擎为数组提供更好的压缩" class="headerlink" title="默认的pickle引擎为数组提供更好的压缩"></a>默认的pickle引擎为数组提供更好的压缩</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="keyword">import</span> cPickle <span class="keyword">as</span> pickle</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">print</span> len(pickle.dumps(numpy.random.normal(size=[<span class="number">1000</span>, <span class="number">1000</span>])))</span><br><span class="line"><span class="comment"># result: 23691675</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line">len(pickle.dumps(numpy.random.normal(size=[<span class="number">1000</span>, <span class="number">1000</span>])))</span><br><span class="line"><span class="comment"># result: 8000162</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Three times less space. And it is <em>much</em> faster.<br>Actually similar compression (but not speed) is achievable with <code>protocol=2</code> parameter, but users typically ignore this option (or simply are not aware of it).</p>
</blockquote>
<p>1/3的空间，以及<em>更加</em>快的速度。事实上，使用<code>protocol = 2</code>参数可以实现类似的压缩（速度则大相径庭），但用户通常会忽略此选项（或者根本不知道它）。</p>
<h2 id="更安全的压缩"><a href="#更安全的压缩" class="headerlink" title="更安全的压缩"></a>更安全的压缩</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">labels = &lt;initial_value&gt;</span><br><span class="line">predictions = [model.predict(data) <span class="keyword">for</span> data, labels <span class="keyword">in</span> dataset]</span><br><span class="line"></span><br><span class="line"><span class="comment"># labels are overwritten in Python 2</span></span><br><span class="line"><span class="comment"># labels are not affected by comprehension in Python 3</span></span><br></pre></td></tr></table></figure>
<h2 id="超简单的super-函数"><a href="#超简单的super-函数" class="headerlink" title="超简单的super()函数"></a>超简单的super()函数</h2><blockquote>
<p>Python 2 <code>super(...)</code> was a frequent source of mistakes in code.</p>
</blockquote>
<p>Python 2 中的<code>super(...)</code>曾是代码中最常见的错误源头。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span><span class="params">(MySuperClass)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, **options)</span>:</span></span><br><span class="line">        super(MySubClass, self).__init__(name=<span class="string">'subclass'</span>, **options)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span><span class="params">(MySuperClass)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, **options)</span>:</span></span><br><span class="line">        super().__init__(name=<span class="string">'subclass'</span>, **options)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>More on <code>super</code> and method resolution order on <a href="https://stackoverflow.com/questions/576169/understanding-python-super-with-init-methods" target="_blank" rel="noopener">stackoverflow</a>.</p>
</blockquote>
<p><a href="https://stackoverflow.com/questions/576169/understanding-python-super-with-init-methods" target="_blank" rel="noopener">stackoverflow</a>上有更多关于<code>super</code>和方法解决的信息。</p>
<h2 id="有着变量注释的更好的IDE建议"><a href="#有着变量注释的更好的IDE建议" class="headerlink" title="有着变量注释的更好的IDE建议"></a>有着变量注释的更好的IDE建议</h2><blockquote>
<p>The most enjoyable thing about programming in languages like Java, C# and alike is that IDE can make very good suggestions,<br>because type of each identifier is known before executing a program.</p>
</blockquote>
<p>关于Java，C＃等语言编程最令人享受的事情是IDE可以提出非常好的建议，因为每个标识符的类型在执行程序之前是已知的。</p>
<blockquote>
<p>In python this is hard to achieve, but annotations will help you</p>
<ul>
<li>write your expectations in a clear form</li>
<li>and get good suggestions from IDE</li>
</ul>
</blockquote>
<p>Python中这很难实现，但注释是会帮助你的</p>
<ul>
<li>以清晰的形式写下你的期望</li>
<li>并从IDE获得很好的建议</li>
</ul>
<p><img src="images/variable_annotations.png"><br></p>
<blockquote>
<p>This is an example of PyCharm suggestions with variable annotations.<br>This works even in situations when functions you use are not annotated (e.g. due to backward compatibility).</p>
</blockquote>
<p>这是PyCharm带有变量声明建议的一个例子。即使在你使用的功能未被注释过的情况依旧是有效的（例如，向后的兼容性）。</p>
<h2 id="更多的解包（unpacking）"><a href="#更多的解包（unpacking）" class="headerlink" title="更多的解包（unpacking）"></a>更多的解包（unpacking）</h2><blockquote>
<p>Here is how you merge two dicts now:</p>
</blockquote>
<p>现在展示如何合并两个字典：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = dict(a=<span class="number">1</span>, b=<span class="number">2</span>)</span><br><span class="line">y = dict(b=<span class="number">3</span>, d=<span class="number">4</span>)</span><br><span class="line"><span class="comment"># Python 3.5+</span></span><br><span class="line">z = &#123;**x, **y&#125;</span><br><span class="line"><span class="comment"># z = &#123;'a': 1, 'b': 3, 'd': 4&#125;, note that value for `b` is taken from the latter dict.</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>See <a href="https://stackoverflow.com/questions/38987/how-to-merge-two-dictionaries-in-a-single-expression" target="_blank" rel="noopener">this thread at StackOverflow</a> for a comparison with Python 2.</p>
</blockquote>
<p>请参照<a href="https://stackoverflow.com/questions/38987/how-to-merge-two-dictionaries-in-a-single-expression" target="_blank" rel="noopener">在StackOverflow上的这一过程</a>，与Python 2进行比较。</p>
<blockquote>
<p>The same approach also works for lists, tuples, and sets (<code>a</code>, <code>b</code>, <code>c</code> are any iterables):</p>
</blockquote>
<p>同样的方法对于列表，元组，以及集合（<code>a</code>, <code>b</code>, <code>c</code> 是可任意迭代的）：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[*a, *b, *c] <span class="comment"># list, concatenating</span></span><br><span class="line">(*a, *b, *c) <span class="comment"># tuple, concatenating</span></span><br><span class="line">&#123;*a, *b, *c&#125; <span class="comment"># set, union</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Functions also <a href="https://docs.python.org/3/whatsnew/3.5.html#whatsnew-pep-448" target="_blank" rel="noopener">support this</a> for <code>*args</code> and <code>**kwargs</code>:</p>
</blockquote>
<p>函数对于参数<code>*args</code>和<code>**kwargs</code>同样<a href="https://docs.python.org/3/whatsnew/3.5.html#whatsnew-pep-448" target="_blank" rel="noopener">支持</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Python 3.5+</span><br><span class="line">do_something(**&#123;**default_settings, **custom_settings&#125;)</span><br><span class="line"></span><br><span class="line"># Also possible, this code also checks there is no intersection between keys of dictionaries</span><br><span class="line">do_something(**first_args, **second_args)</span><br></pre></td></tr></table></figure></p>
<h2 id="具有关键字参数的面向未来的API"><a href="#具有关键字参数的面向未来的API" class="headerlink" title="具有关键字参数的面向未来的API"></a>具有关键字参数的面向未来的API</h2><p>让我们看一下这个代码片段：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = sklearn.svm.SVC(<span class="number">2</span>, <span class="string">'poly'</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">0.5</span>)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Obviously, an author of this code didn’t get the Python style of coding yet (most probably, just jumped from cpp or rust).<br>Unfortunately, this is not just question of taste, because changing the order of arguments (adding/deleting) in <code>SVC</code> will break this code. In particular, <code>sklearn</code> does some reordering/renaming from time to time of numerous algorithm parameters to provide consistent API. Each such refactoring may drive to broken code.</p>
</blockquote>
<p>很明显，代码的作者还未理解Python的编码风格（很有可能是从cpp或者rust转到Python的）。<br>不幸的是，这不仅仅是品味的问题，因为在<code>SVC</code>中改变参数顺序（添加/删除）都会破坏代码。 特别是，<code>sklearn</code>会不时地对许多算法参数进行重新排序/重命名以提供一致的API。 每个这样的重构都可能导致代码损坏。</p>
<blockquote>
<p>In Python 3, library authors may demand explicitly named parameters by using <code>*</code>:</p>
</blockquote>
<p>在Python 3中，类库作者可能会通过使用<code>*</code>来要求明确命名的参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class SVC(BaseSVC):</span><br><span class="line">    def __init__(self, *, C=1.0, kernel=&apos;rbf&apos;, degree=3, gamma=&apos;auto&apos;, coef0=0.0, ... )</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li>users have to specify names of parameters <code>sklearn.svm.SVC(C=2, kernel=&#39;poly&#39;, degree=2, gamma=4, coef0=0.5)</code> now</li>
<li>this mechanism provides a great combination of reliability and flexibility of APIs</li>
</ul>
</blockquote>
<ul>
<li>用户现在必须指定参数名称为<code>sklearn.svm.SVC(C=2, kernel=&#39;poly&#39;, degree=2, gamma=4, coef0=0.5)</code></li>
<li>这种机制提供了API完美结合的可靠性和灵活性</li>
</ul>
<h2 id="次要-math模块中的常量"><a href="#次要-math模块中的常量" class="headerlink" title="次要: math模块中的常量"></a>次要: <code>math</code>模块中的常量</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 3</span></span><br><span class="line">math.inf <span class="comment"># 'largest' number</span></span><br><span class="line">math.nan <span class="comment"># not a number</span></span><br><span class="line"></span><br><span class="line">max_quality = -math.inf  <span class="comment"># no more magic initial values!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> model <span class="keyword">in</span> trained_models:</span><br><span class="line">    max_quality = max(max_quality, compute_quality(model, data))</span><br></pre></td></tr></table></figure>
<h2 id="次要-单一的整数类型"><a href="#次要-单一的整数类型" class="headerlink" title="次要: 单一的整数类型"></a>次要: 单一的整数类型</h2><blockquote>
<p>Python 2 provides two basic integer types, which are int (64-bit signed integer) and long for long arithmetics (quite confusing after C++).</p>
</blockquote>
<p>Python 2提供了两种基础的整数类型，int(64位有符号的整数)以及对于长整型计算的long（在C++之后就变得非常混乱）。</p>
<blockquote>
<p>Python 3 has a single type <code>int</code>, which incorporates long arithmetics.</p>
</blockquote>
<p>Python 3有着单一的类型<code>int</code>，其同时融合了长整型的计算。</p>
<blockquote>
<p>Here is how you check that value is integer:</p>
</blockquote>
<p>如下为如何检查该值是整数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isinstance(x, numbers.Integral) # Python 2, the canonical way</span><br><span class="line">isinstance(x, (long, int))      # Python 2</span><br><span class="line">isinstance(x, int)              # Python 3, easier to remember</span><br></pre></td></tr></table></figure>
<h2 id="其他事项"><a href="#其他事项" class="headerlink" title="其他事项"></a>其他事项</h2><ul>
<li><code>Enum</code>s are theoretically useful, but<ul>
<li>string-typing is already widely adopted in the python data stack</li>
<li><code>Enum</code>s don’t seem to interplay with numpy and categorical from pandas</li>
</ul>
</li>
<li>coroutines also <em>sound</em> very promising for data pipelining (see <a href="http://www.dabeaz.com/coroutines/Coroutines.pdf" target="_blank" rel="noopener">slides</a> by David Beazley), but I don’t see their adoption in the wild.</li>
<li>Python 3 has <a href="https://www.python.org/dev/peps/pep-0384/" target="_blank" rel="noopener">stable ABI</a></li>
<li>Python 3 supports unicode identifies (so <code>ω = Δφ / Δt</code> is ok), but you’d <a href="https://stackoverflow.com/a/29855176/498892" target="_blank" rel="noopener">better use good old ASCII names</a></li>
<li>some libraries e.g. <a href="https://github.com/jupyterhub/jupyterhub" target="_blank" rel="noopener">jupyterhub</a> (jupyter in cloud), django and fresh ipython only support Python 3, so features that sound useless for you are useful for libraries you’ll probably want to use once.</li>
</ul>
<hr>
<ul>
<li><code>Enum</code>（枚举类）理论上是有用的，但是<ul>
<li>string-typing 已经在Python数据栈中被广泛采用</li>
<li><code>Enum</code>似乎不会与numpy和pandas的分类相互作用</li>
</ul>
</li>
<li>协程（coroutines）<em>听起来</em>也非常适用于数据管道（参见David Beazley的<a href="http://www.dabeaz.com/coroutines/Coroutines.pdf" target="_blank" rel="noopener">幻灯片</a>），但是我从来没见过代码引用它们。</li>
<li><p>Python 3 有着<a href="https://www.python.org/dev/peps/pep-0384/" target="_blank" rel="noopener">稳定的ABI</a></p>
<p><em>ABI（Application Binary Interface）: 应用程序二进制接口 描述了应用程序和操作系统之间，一个应用和它的库之间，或者应用的组成部分之间的低接口。</em></p>
</li>
<li>Python 3支持unicode标识（甚至<code>ω=Δφ/Δt</code>也可以），但是你<a href="https://stackoverflow.com/a/29855176/498892" target="_blank" rel="noopener">最好使用好的旧ASCII名称</a>。</li>
<li>一些类库例如 <a href="https://github.com/jupyterhub/jupyterhub" target="_blank" rel="noopener">jupyterhub</a>（云端的jupyter），django和最新的ipython仅支持Python 3，因此对于您来说听起来无用的功能，对于您可能想要使用的库却很有用。</li>
</ul>
<h3 id="特定于数据科学的代码迁移问题（以及如何解决这些问题）"><a href="#特定于数据科学的代码迁移问题（以及如何解决这些问题）" class="headerlink" title="特定于数据科学的代码迁移问题（以及如何解决这些问题）"></a>特定于数据科学的代码迁移问题（以及如何解决这些问题）</h3><blockquote>
<ul>
<li>support for nested arguments <a href="https://www.python.org/dev/peps/pep-3113/" target="_blank" rel="noopener">was dropped</a></li>
<li><p>对于嵌套参数的支持<a href="https://www.python.org/dev/peps/pep-3113/" target="_blank" rel="noopener">已被删除</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map(lambda x, (y, z): x, z, dict.items())</span><br></pre></td></tr></table></figure>
<p>However, it is still perfectly working with different comprehensions:</p>
</li>
</ul>
</blockquote>
<p>但是，它仍然完全适用于不同的（列表）解析：<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;x:z <span class="keyword">for</span> x, (y, z) <span class="keyword">in</span> d.items()&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p> In general, comprehensions are also better ‘translatable’ between Python 2 and 3.</p>
</blockquote>
<p>一般来说，Python 2和Python 3之间的解析也是有着更好的“可翻译性”。</p>
<blockquote>
<ul>
<li><code>map()</code>, <code>.keys()</code>, <code>.values()</code>, <code>.items()</code>, etc. return iterators, not lists. Main problems with iterators are:<ul>
<li>no trivial slicing</li>
<li>can’t be iterated twice</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li><code>map()</code>， <code>.keys()</code>， <code>.values()</code>， <code>.items()</code>等等返回的是迭代器（iterators），而不是列表（lists）。迭代器的主要问题如下：<ul>
<li>没有细小的切片</li>
<li>不能迭代两次</li>
</ul>
</li>
</ul>
<blockquote>
<p> Almost all of the problems are resolved by converting result to list.</p>
</blockquote>
<p>将结果转换为列表几乎可以解决所有问题。</p>
<blockquote>
<ul>
<li>see <a href="https://eev.ee/blog/2016/07/31/python-faq-how-do-i-port-to-python-3/" target="_blank" rel="noopener">Python FAQ: How do I port to Python 3?</a> when in trouble.</li>
</ul>
</blockquote>
<ul>
<li>当你遇到问题时请参见<a href="https://eev.ee/blog/2016/07/31/python-faq-how-do-i-port-to-python-3/" target="_blank" rel="noopener">Python FAQ: How do I port to Python 3?</a>。</li>
</ul>
<h3 id="使用python教授机器学习和数据科学的主要问题"><a href="#使用python教授机器学习和数据科学的主要问题" class="headerlink" title="使用python教授机器学习和数据科学的主要问题"></a>使用python教授机器学习和数据科学的主要问题</h3><blockquote>
<p>Course authors should spend time in the first lectures to explain what is an iterator,<br>why it can’t be sliced / concatenated / multiplied / iterated twice like a string (and how to deal with it).</p>
</blockquote>
<p>课程讲解者应该花时间在第一讲中解释什么是迭代器，<br>为什么它不能像字符串一样被分割/连接/相乘/重复两次（以及如何处理它）。</p>
<blockquote>
<p>I think most course authors would be happy to avoid these details, but now it is hardly possible.</p>
</blockquote>
<p>我认为大多数课程讲解者曾经都乐于避开这些细节，但现在几乎不可能（再避开了）。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><blockquote>
<p>Python 2 and Python 3 have co-existed for almost 10 years, but we <em>should</em> move to Python 3.</p>
</blockquote>
<p>虽然Python 2 和 Python 3 已经共存了十年有余，但是我们<em>应该</em>要过渡到Python 3 了。</p>
<blockquote>
<p>Research and production code should become a bit shorter, more readable, and significantly safer after moving to Python 3-only codebase.</p>
</blockquote>
<p>在转向使用唯一的 Python 3 代码库之后，研究和生产的代码将会变得更剪短，更有可读性，以及明显是更加安全的。</p>
<blockquote>
<p>Right now most libraries support both Python versions.<br>And I can’t wait for the bright moment when packages drop support for Python 2 and enjoy new language features.</p>
</blockquote>
<p>目前大部分类库都会支持两个Python版本，我已等不及要使用新的语言特性了，也同样期待依赖包舍弃对 Python 2 支持这一光明时刻的到来。</p>
<blockquote>
<p>Following migrations are promised to be smoother: <a href="https://snarky.ca/why-python-3-exists/" target="_blank" rel="noopener">“we will never do this kind of backwards-incompatible change again”</a></p>
</blockquote>
<p>以后的(版本)迁移会更加顺利：<a href="https://snarky.ca/why-python-3-exists/" target="_blank" rel="noopener">我们再也不会做这种不向后兼容的变化了</a>。</p>
<h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><ul>
<li><a href="http://sebastianraschka.com/Articles/2014_python_2_3_key_diff.html" target="_blank" rel="noopener">Key differences between Python 2.7 and Python 3.x</a></li>
<li><a href="https://eev.ee/blog/2016/07/31/python-faq-how-do-i-port-to-python-3/" target="_blank" rel="noopener">Python FAQ: How do I port to Python 3?</a></li>
<li><a href="http://www.asmeurer.com/python3-presentation/slides.html" target="_blank" rel="noopener">10 awesome features of Python that you can’t use because you refuse to upgrade to Python 3</a></li>
<li><a href="http://pyvideo.org/pycon-us-2013/python-33-trust-me-its-better-than-27.html" target="_blank" rel="noopener">Trust me, python 3.3 is better than 2.7 (video)</a></li>
<li><a href="http://python-3-for-scientists.readthedocs.io/en/latest/" target="_blank" rel="noopener">Python 3 for scientists</a></li>
</ul>
<h3 id="版权声明"><a href="#版权声明" class="headerlink" title="版权声明"></a>版权声明</h3><p>This text was published by <a href="https://arogozhnikov.github.io/about/" target="_blank" rel="noopener">Alex Rogozhnikov</a> under <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0 License</a> (excluding images)</p>

      
    </div>

    
    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/posts/4197357137.html">Migrating to Python 3 with pleasure</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Joseph 的个人博客">Joseph</a></p>
  <p><span>发布时间:</span>2019年05月04日 - 09:05</p>
  <p><span>最后更新:</span>2019年05月04日 - 09:05</p>
  <p><span>原始链接:</span><a href="/posts/4197357137.html" title="Migrating to Python 3 with pleasure">https://jacksonleon.gitee.io/posts/4197357137.html</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://jacksonleon.gitee.io/posts/4197357137.html" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
    });
    });  
</script>

      
    </div>
    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
          
            <a href="/tags/Reproduce/" rel="tag"><i class="fa fa-tag"></i> Reproduce</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/271955539.html" rel="next" title="Commit messages guide">
                Commit messages guide <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
            <a href="/">
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Joseph">
            </a>
            
              <p class="site-author-name" itemprop="name">Joseph</p>
              <p class="site-description motion-element" itemprop="description">Love what you do, do what you love.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">62</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">42</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/JacksonLeon" title="GitHub &rarr; https://github.com/JacksonLeon" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:pumbjackson@gmail.com" title="E-Mail &rarr; mailto:pumbjackson@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Recommend
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jacksonleon.github.io/posts/3890174064.html" title="https://jacksonleon.github.io/posts/3890174064.html" rel="noopener" target="_blank">Git Note</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jacksonleon.github.io/posts/1999510617.html" title="https://jacksonleon.github.io/posts/1999510617.html" rel="noopener" target="_blank">Python Note</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jacksonleon.github.io/posts/3307335557.html" title="https://jacksonleon.github.io/posts/3307335557.html" rel="noopener" target="_blank">Blog With Hexo</a>
                  </li>
                
              </ul>
            <div id="days"></div>
<script>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("01/01/2018 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>
            </div>
          

          
            
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Migrating-to-Python-3-with-pleasure"><span class="nav-number">1.</span> <span class="nav-text">Migrating to Python 3 with pleasure</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#English-version"><span class="nav-number">2.</span> <span class="nav-text">English version</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-short-guide-on-features-of-Python-3-for-data-scientists"><span class="nav-number">2.1.</span> <span class="nav-text">A short guide on features of Python 3 for data scientists</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Better-paths-handling-with-pathlib"><span class="nav-number">2.2.</span> <span class="nav-text">Better paths handling with pathlib</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Type-hinting-is-now-part-of-the-language"><span class="nav-number">2.3.</span> <span class="nav-text">Type hinting is now part of the language</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Type-hinting-→-type-checking-in-runtime"><span class="nav-number">2.4.</span> <span class="nav-text">Type hinting → type checking in runtime</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-usages-of-function-annotations"><span class="nav-number">2.5.</span> <span class="nav-text">Other usages of function annotations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Matrix-multiplication-with"><span class="nav-number">2.6.</span> <span class="nav-text">Matrix multiplication with @</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Globbing-with"><span class="nav-number">2.7.</span> <span class="nav-text">Globbing with **</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Print-is-a-function-now"><span class="nav-number">2.8.</span> <span class="nav-text">Print is a function now</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Underscores-in-Numeric-Literal-Thousands-Separator"><span class="nav-number">2.9.</span> <span class="nav-text">Underscores in Numeric Literal (Thousands Separator)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#f-strings-for-simple-and-reliable-formatting"><span class="nav-number">2.10.</span> <span class="nav-text">f-strings for simple and reliable formatting</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explicit-difference-between-‘true-division’-and-‘floor-division’"><span class="nav-number">2.11.</span> <span class="nav-text">Explicit difference between ‘true division’ and ‘floor division’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Strict-ordering"><span class="nav-number">2.12.</span> <span class="nav-text">Strict ordering</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unicode-for-NLP"><span class="nav-number">2.13.</span> <span class="nav-text">Unicode for NLP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Preserving-order-of-dictionaries-and-kwargs"><span class="nav-number">2.14.</span> <span class="nav-text">Preserving order of dictionaries and **kwargs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Iterable-unpacking"><span class="nav-number">2.15.</span> <span class="nav-text">Iterable unpacking</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Default-pickle-engine-provides-better-compression-for-arrays"><span class="nav-number">2.16.</span> <span class="nav-text">Default pickle engine provides better compression for arrays</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Safer-comprehensions"><span class="nav-number">2.17.</span> <span class="nav-text">Safer comprehensions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Super-simply-super"><span class="nav-number">2.18.</span> <span class="nav-text">Super, simply super()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Better-IDE-suggestions-with-variable-annotations"><span class="nav-number">2.19.</span> <span class="nav-text">Better IDE suggestions with variable annotations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multiple-unpacking"><span class="nav-number">2.20.</span> <span class="nav-text">Multiple unpacking</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Future-proof-APIs-with-keyword-only-arguments"><span class="nav-number">2.21.</span> <span class="nav-text">Future-proof APIs with keyword-only arguments</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-classes"><span class="nav-number">2.22.</span> <span class="nav-text">Data classes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Customizing-access-to-module-attributes"><span class="nav-number">2.23.</span> <span class="nav-text">Customizing access to module attributes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Built-in-breakpoint"><span class="nav-number">2.24.</span> <span class="nav-text">Built-in breakpoint()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Minor-constants-in-math-module"><span class="nav-number">2.25.</span> <span class="nav-text">Minor: constants in math module</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Minor-single-integer-type"><span class="nav-number">2.26.</span> <span class="nav-text">Minor: single integer type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-stuff"><span class="nav-number">2.27.</span> <span class="nav-text">Other stuff</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Problems-for-code-migration-specific-for-data-science-and-how-to-resolve-those"><span class="nav-number">2.27.1.</span> <span class="nav-text">Problems for code migration specific for data science (and how to resolve those)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Main-problems-for-teaching-machine-learning-and-data-science-with-python"><span class="nav-number">2.27.2.</span> <span class="nav-text">Main problems for teaching machine learning and data science with python</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">2.28.</span> <span class="nav-text">Conclusion</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Links"><span class="nav-number">2.28.1.</span> <span class="nav-text">Links</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#License"><span class="nav-number">2.28.2.</span> <span class="nav-text">License</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#中文版本"><span class="nav-number">3.</span> <span class="nav-text">中文版本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#为数据科学家提供的关于Python-3特性的简介"><span class="nav-number">3.1.</span> <span class="nav-text">为数据科学家提供的关于Python 3特性的简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pathlib提供了更好的路径处理"><span class="nav-number">3.2.</span> <span class="nav-text">pathlib提供了更好的路径处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类型提示现在已是这语言的一部分"><span class="nav-number">3.3.</span> <span class="nav-text">类型提示现在已是这语言的一部分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类型提示-→-在运行时检查类型"><span class="nav-number">3.4.</span> <span class="nav-text">类型提示 → 在运行时检查类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法声明的其他用途"><span class="nav-number">3.5.</span> <span class="nav-text">方法声明的其他用途</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#矩阵乘号"><span class="nav-number">3.6.</span> <span class="nav-text">矩阵乘号 @</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通配符"><span class="nav-number">3.7.</span> <span class="nav-text">通配符 **</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Print-现在成了一个方法"><span class="nav-number">3.8.</span> <span class="nav-text">Print 现在成了一个方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数字中的下划线-（千位分隔符）"><span class="nav-number">3.9.</span> <span class="nav-text">数字中的下划线 （千位分隔符）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用于简单可靠格式化的-f-strings"><span class="nav-number">3.10.</span> <span class="nav-text">用于简单可靠格式化的 f-strings</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#“真正的除法”与“整数除法”之间的明显区别"><span class="nav-number">3.11.</span> <span class="nav-text">“真正的除法”与“整数除法”之间的明显区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#严谨的排序"><span class="nav-number">3.12.</span> <span class="nav-text">严谨的排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用于NLP的Unicode"><span class="nav-number">3.13.</span> <span class="nav-text">用于NLP的Unicode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保留字典和-kwargs的顺序"><span class="nav-number">3.14.</span> <span class="nav-text">保留字典和** kwargs的顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可迭代对象的（Iterable）解压"><span class="nav-number">3.15.</span> <span class="nav-text">可迭代对象的（Iterable）解压</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#默认的pickle引擎为数组提供更好的压缩"><span class="nav-number">3.16.</span> <span class="nav-text">默认的pickle引擎为数组提供更好的压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更安全的压缩"><span class="nav-number">3.17.</span> <span class="nav-text">更安全的压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#超简单的super-函数"><span class="nav-number">3.18.</span> <span class="nav-text">超简单的super()函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#有着变量注释的更好的IDE建议"><span class="nav-number">3.19.</span> <span class="nav-text">有着变量注释的更好的IDE建议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更多的解包（unpacking）"><span class="nav-number">3.20.</span> <span class="nav-text">更多的解包（unpacking）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#具有关键字参数的面向未来的API"><span class="nav-number">3.21.</span> <span class="nav-text">具有关键字参数的面向未来的API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#次要-math模块中的常量"><span class="nav-number">3.22.</span> <span class="nav-text">次要: math模块中的常量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#次要-单一的整数类型"><span class="nav-number">3.23.</span> <span class="nav-text">次要: 单一的整数类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他事项"><span class="nav-number">3.24.</span> <span class="nav-text">其他事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特定于数据科学的代码迁移问题（以及如何解决这些问题）"><span class="nav-number">3.24.1.</span> <span class="nav-text">特定于数据科学的代码迁移问题（以及如何解决这些问题）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用python教授机器学习和数据科学的主要问题"><span class="nav-number">3.24.2.</span> <span class="nav-text">使用python教授机器学习和数据科学的主要问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结论"><span class="nav-number">3.25.</span> <span class="nav-text">结论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#相关链接"><span class="nav-number">3.25.1.</span> <span class="nav-text">相关链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#版权声明"><span class="nav-number">3.25.2.</span> <span class="nav-text">版权声明</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="heart">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Joseph</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Symbols count total: </span>
    
    <span title="Symbols count total">374k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    
    <span title="Reading time total">5:40</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: 'O9aoAtFO2Mk0VrPqbyHMHwah-gzGzoHsz',
    appKey: '1bF6m0SPiN3sk9TaGxPELdjY',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  
  

  


  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('Copied');
          else $(this).text('Copy failed');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('Copy');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>